<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExploreX Comprehensive Testing Suite</title>
    <link rel="stylesheet" href="explorex-testing-styles.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            min-height: 100vh;
        }

        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .test-header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .test-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .test-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .dashboard-card h3 {
            margin: 0 0 20px 0;
            color: #1e293b;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.5rem;
        }

        .test-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .control-group h4 {
            margin-top: 0;
            color: #495057;
            font-size: 1.1rem;
        }

        .btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);
        }

        .btn.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .btn.info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .status-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .status-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .status-label {
            color: #64748b;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .log-container {
            background: #1e293b;
            color: #10b981;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .test-runner-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .progress-container {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f1f5f9;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .metric-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
        }

        .metric-card h4 {
            margin-top: 0;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coverage-bar {
            background: #f1f5f9;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .coverage-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            transition: width 0.3s ease;
        }

        .test-type-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .unit { background-color: #10b981; }
        .integration { background-color: #3b82f6; }
        .e2e { background-color: #8b5cf6; }
        .performance { background-color: #f59e0b; }
        .accessibility { background-color: #ef4444; }
    </style>
</head>
<body>
    <div class="test-runner-toggle">
        <button class="btn" onclick="toggleTestRunner()">
            🧪 Test Runner
        </button>
    </div>

    <div class="test-container">
        <div class="test-header">
            <h1>🧪 ExploreX Comprehensive Testing Suite</h1>
            <p>Advanced testing platform with unit tests, integration tests, E2E tests, performance tests, and accessibility compliance</p>
        </div>

        <div class="test-dashboard">
            <div class="dashboard-card">
                <h3><span class="card-icon">🔬</span>Unit Tests</h3>
                <p>Component and service testing with isolated test cases for individual functions and modules.</p>
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-value" id="unit-total">0</div>
                        <div class="status-label">Total Tests</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value" id="unit-passed">0</div>
                        <div class="status-label">Passed</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <h3><span class="card-icon">🔗</span>Integration Tests</h3>
                <p>API integration testing for weather, events, and external service connections.</p>
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-value" id="integration-total">0</div>
                        <div class="status-label">Total Tests</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value" id="integration-passed">0</div>
                        <div class="status-label">Passed</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <h3><span class="card-icon">🎭</span>End-to-End Tests</h3>
                <p>Complete user journey testing from search to booking and itinerary creation.</p>
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-value" id="e2e-total">0</div>
                        <div class="status-label">Total Tests</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value" id="e2e-passed">0</div>
                        <div class="status-label">Passed</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <h3><span class="card-icon">⚡</span>Performance Tests</h3>
                <p>Performance benchmarking for search, recommendations, and page load times.</p>
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-value" id="performance-total">0</div>
                        <div class="status-label">Total Tests</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value" id="performance-passed">0</div>
                        <div class="status-label">Passed</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <h3><span class="card-icon">♿</span>Accessibility Tests</h3>
                <p>WCAG 2.1 AA compliance testing for keyboard navigation and screen readers.</p>
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-value" id="accessibility-total">0</div>
                        <div class="status-label">Total Tests</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value" id="accessibility-passed">0</div>
                        <div class="status-label">Passed</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <h3><span class="card-icon">📊</span>Test Coverage</h3>
                <p>Code coverage analysis and testing completeness metrics.</p>
                <div class="coverage-bar">
                    <div class="coverage-fill" id="coverage-fill" style="width: 0%"></div>
                </div>
                <div class="status-value" id="coverage-percentage">0%</div>
            </div>
        </div>

        <div class="progress-container">
            <h3>🚀 Test Execution Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="test-progress" style="width: 0%"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <span id="progress-text">Ready to run tests</span>
                <span id="progress-stats">0/0 tests completed</span>
            </div>
        </div>

        <div class="test-controls">
            <div class="control-group">
                <h4>🧪 Test Execution</h4>
                <button class="btn success" onclick="runAllTests()">Run All Tests</button>
                <button class="btn" onclick="runUnitTests()">Run Unit Tests</button>
                <button class="btn" onclick="runIntegrationTests()">Run Integration Tests</button>
                <button class="btn" onclick="runE2ETests()">Run E2E Tests</button>
            </div>

            <div class="control-group">
                <h4>⚡ Performance Testing</h4>
                <button class="btn warning" onclick="runPerformanceTests()">Run Performance Tests</button>
                <button class="btn warning" onclick="benchmarkSearch()">Benchmark Search</button>
                <button class="btn warning" onclick="benchmarkRecommendations()">Benchmark Recommendations</button>
                <button class="btn warning" onclick="memoryLeakTest()">Memory Leak Test</button>
            </div>

            <div class="control-group">
                <h4>♿ Accessibility Testing</h4>
                <button class="btn info" onclick="runAccessibilityTests()">Run Accessibility Tests</button>
                <button class="btn info" onclick="testKeyboardNavigation()">Test Keyboard Navigation</button>
                <button class="btn info" onclick="testScreenReader()">Test Screen Reader</button>
                <button class="btn info" onclick="testColorContrast()">Test Color Contrast</button>
            </div>

            <div class="control-group">
                <h4>📊 Reporting & Analysis</h4>
                <button class="btn" onclick="generateTestReport()">Generate Test Report</button>
                <button class="btn" onclick="exportTestResults()">Export Test Results</button>
                <button class="btn" onclick="analyzeCoverage()">Analyze Coverage</button>
                <button class="btn danger" onclick="clearTestResults()">Clear Test Results</button>
            </div>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <h4>📈 Test Metrics</h4>
                <div id="test-metrics">
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Total Tests:</span>
                        <span id="total-tests">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Passed:</span>
                        <span id="total-passed" style="color: #10b981;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Failed:</span>
                        <span id="total-failed" style="color: #ef4444;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Skipped:</span>
                        <span id="total-skipped" style="color: #f59e0b;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Pass Rate:</span>
                        <span id="pass-rate">0%</span>
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h4>⚡ Performance Metrics</h4>
                <div id="performance-metrics">
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Page Load:</span>
                        <span id="page-load-time">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Search Time:</span>
                        <span id="search-time">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Memory Usage:</span>
                        <span id="memory-usage">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>API Response:</span>
                        <span id="api-response-time">-</span>
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h4>♿ Accessibility Score</h4>
                <div style="text-align: center;">
                    <div style="font-size: 3rem; font-weight: bold; color: #10b981; margin: 20px 0;" id="accessibility-score">-</div>
                    <div style="color: #64748b;">WCAG 2.1 AA Compliance</div>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>Issues Found:</span>
                            <span id="accessibility-issues">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>Critical:</span>
                            <span id="critical-issues" style="color: #ef4444;">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h4>📊 Test Coverage</h4>
                <div id="coverage-details">
                    <div style="margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Functions:</span>
                            <span id="function-coverage">0%</span>
                        </div>
                        <div class="coverage-bar">
                            <div class="coverage-fill" id="function-coverage-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div style="margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Lines:</span>
                            <span id="line-coverage">0%</span>
                        </div>
                        <div class="coverage-bar">
                            <div class="coverage-fill" id="line-coverage-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div style="margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Branches:</span>
                            <span id="branch-coverage">0%</span>
                        </div>
                        <div class="coverage-bar">
                            <div class="coverage-fill" id="branch-coverage-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="log-container" id="log-container">
            <div>🧪 ExploreX Comprehensive Testing Suite Console</div>
            <div>Ready to execute comprehensive test suite...</div>
        </div>
    </div>

    <!-- Load Testing Framework -->
    <script src="explorex-testing-framework.js"></script>

    <!-- Load ExploreX Systems for Testing -->
    <script src="explorex-models.js"></script>
    <script src="explorex-utils.js"></script>
    <script src="explorex-database.js"></script>
    <script src="explorex-location-services.js"></script>
    <script src="explorex-search-engine.js"></script>
    <script src="explorex-user-system.js"></script>
    <script src="explorex-weather-api.js"></script>
    <script src="explorex-events-api.js"></script>

    <script>
        // Global variables
        let testingFramework;
        let testResults = {
            unit: { total: 0, passed: 0, failed: 0, skipped: 0 },
            integration: { total: 0, passed: 0, failed: 0, skipped: 0 },
            e2e: { total: 0, passed: 0, failed: 0, skipped: 0 },
            performance: { total: 0, passed: 0, failed: 0, skipped: 0 },
            accessibility: { total: 0, passed: 0, failed: 0, skipped: 0 }
        };
        let isRunning = false;

        // Initialize testing framework
        async function initializeTestingFramework() {
            try {
                log('🚀 Initializing Comprehensive Testing Framework...');

                // Initialize Testing Framework
                testingFramework = new window.ExploreXTesting.TestingFramework();
                await testingFramework.initialize();

                // Update test counts
                updateTestCounts();

                // Make testing framework globally available for debugging
                window.ExploreXTestingDebug = {
                    framework: testingFramework,
                    runTests: (suite) => runTestSuite(suite),
                    getResults: () => testResults,
                    exportResults: () => testingFramework.exportResults()
                };

                log('✅ Testing Framework initialized successfully');

            } catch (error) {
                log(`❌ Testing Framework initialization failed: ${error.message}`);
                console.error('Testing Framework initialization error:', error);
            }
        }

        // Update test counts
        function updateTestCounts() {
            if (!testingFramework) return;

            for (const [suiteName, suite] of testingFramework.testSuites) {
                const count = suite.getTestCount();
                document.getElementById(`${suiteName}-total`).textContent = count;
                testResults[suiteName].total = count;
            }

            updateTotalMetrics();
        }

        // Test execution functions
        async function runAllTests() {
            if (isRunning) return;
            
            try {
                isRunning = true;
                updateProgress(0, 'Starting comprehensive test suite...');
                log('🚀 Starting comprehensive test suite execution...');

                const results = await testingFramework.runAllTests();
                
                // Update results
                Object.entries(results.suites).forEach(([suiteName, suiteResult]) => {
                    testResults[suiteName] = suiteResult;
                    updateSuiteMetrics(suiteName, suiteResult);
                });

                updateTotalMetrics();
                updateProgress(100, 'All tests completed!');
                
                log(`✅ Test suite completed: ${results.passed}/${results.total} passed`);

            } catch (error) {
                log(`❌ Test execution failed: ${error.message}`);
            } finally {
                isRunning = false;
            }
        }

        async function runUnitTests() {
            await runTestSuite('unit', 'Unit Tests');
        }

        async function runIntegrationTests() {
            await runTestSuite('integration', 'Integration Tests');
        }

        async function runE2ETests() {
            await runTestSuite('e2e', 'End-to-End Tests');
        }

        async function runTestSuite(suiteName, displayName) {
            if (isRunning) return;

            try {
                isRunning = true;
                updateProgress(0, `Running ${displayName}...`);
                log(`🧪 Running ${displayName}...`);

                const suite = testingFramework.testSuites.get(suiteName);
                if (!suite) {
                    throw new Error(`Test suite '${suiteName}' not found`);
                }

                const results = await testingFramework.runTestSuite(suite);
                
                testResults[suiteName] = results;
                updateSuiteMetrics(suiteName, results);
                updateTotalMetrics();
                updateProgress(100, `${displayName} completed!`);
                
                log(`✅ ${displayName} completed: ${results.passed}/${results.total} passed`);

            } catch (error) {
                log(`❌ ${displayName} failed: ${error.message}`);
            } finally {
                isRunning = false;
            }
        }

        // Performance testing functions
        async function runPerformanceTests() {
            await runTestSuite('performance', 'Performance Tests');
        }

        async function benchmarkSearch() {
            log('⚡ Running search benchmark...');
            
            const startTime = performance.now();
            
            // Simulate search operations
            for (let i = 0; i < 100; i++) {
                // Simulate search
                await new Promise(resolve => setTimeout(resolve, 10));
            }
            
            const duration = performance.now() - startTime;
            const avgTime = duration / 100;
            
            document.getElementById('search-time').textContent = `${avgTime.toFixed(2)}ms`;
            log(`📊 Search benchmark: ${avgTime.toFixed(2)}ms average`);
        }

        async function benchmarkRecommendations() {
            log('⚡ Running recommendations benchmark...');
            
            const startTime = performance.now();
            
            // Simulate recommendation calculations
            for (let i = 0; i < 50; i++) {
                // Simulate ML calculations
                await new Promise(resolve => setTimeout(resolve, 20));
            }
            
            const duration = performance.now() - startTime;
            const avgTime = duration / 50;
            
            log(`📊 Recommendations benchmark: ${avgTime.toFixed(2)}ms average`);
        }

        async function memoryLeakTest() {
            log('🧠 Running memory leak test...');
            
            const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            
            // Create and destroy objects to test for leaks
            for (let i = 0; i < 1000; i++) {
                const testObjects = new Array(1000).fill(null).map(() => ({
                    id: i,
                    data: new Array(100).fill('test-data'),
                    timestamp: Date.now()
                }));
                
                // Clear references
                testObjects.length = 0;
            }
            
            // Force garbage collection if available
            if (window.gc) {
                window.gc();
            }
            
            const finalMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            const memoryDiff = finalMemory - initialMemory;
            
            document.getElementById('memory-usage').textContent = `${Math.round(finalMemory / 1024 / 1024)}MB`;
            
            log(`🧠 Memory test: ${memoryDiff > 0 ? '+' : ''}${Math.round(memoryDiff / 1024)}KB`);
        }

        // Accessibility testing functions
        async function runAccessibilityTests() {
            await runTestSuite('accessibility', 'Accessibility Tests');
        }

        async function testKeyboardNavigation() {
            log('⌨️ Testing keyboard navigation...');
            
            let issues = 0;
            const focusableElements = document.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            
            focusableElements.forEach((element, index) => {
                try {
                    element.focus();
                    if (document.activeElement !== element) {
                        issues++;
                    }
                } catch (error) {
                    issues++;
                }
            });
            
            document.getElementById('accessibility-issues').textContent = issues;
            log(`⌨️ Keyboard navigation: ${issues} issues found`);
        }

        async function testScreenReader() {
            log('🔊 Testing screen reader compatibility...');
            
            let issues = 0;
            const images = document.querySelectorAll('img');
            const buttons = document.querySelectorAll('button');
            const inputs = document.querySelectorAll('input');
            
            // Check for missing alt text
            images.forEach(img => {
                if (!img.alt && !img.getAttribute('aria-label')) {
                    issues++;
                }
            });
            
            // Check for missing button labels
            buttons.forEach(btn => {
                if (!btn.textContent.trim() && !btn.getAttribute('aria-label')) {
                    issues++;
                }
            });
            
            // Check for missing input labels
            inputs.forEach(input => {
                if (!input.labels?.length && !input.getAttribute('aria-label')) {
                    issues++;
                }
            });
            
            document.getElementById('critical-issues').textContent = issues;
            log(`🔊 Screen reader: ${issues} critical issues found`);
        }

        async function testColorContrast() {
            log('🎨 Testing color contrast...');
            
            // Simplified contrast test
            let contrastIssues = 0;
            const elements = document.querySelectorAll('*');
            
            elements.forEach(element => {
                const styles = getComputedStyle(element);
                const color = styles.color;
                const backgroundColor = styles.backgroundColor;
                
                // Very basic contrast check (would need proper calculation in real implementation)
                if (color && backgroundColor && color === backgroundColor) {
                    contrastIssues++;
                }
            });
            
            log(`🎨 Color contrast: ${contrastIssues} potential issues found`);
        }

        // Reporting functions
        function generateTestReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: calculateTotalMetrics(),
                suites: testResults,
                performance: {
                    pageLoad: document.getElementById('page-load-time').textContent,
                    searchTime: document.getElementById('search-time').textContent,
                    memoryUsage: document.getElementById('memory-usage').textContent,
                    apiResponse: document.getElementById('api-response-time').textContent
                },
                accessibility: {
                    score: document.getElementById('accessibility-score').textContent,
                    issues: document.getElementById('accessibility-issues').textContent,
                    criticalIssues: document.getElementById('critical-issues').textContent
                }
            };
            
            console.log('📊 Test Report Generated:', report);
            log('📊 Test report generated and logged to console');
        }

        function exportTestResults() {
            if (testingFramework && testingFramework.testReports.length > 0) {
                const filename = testingFramework.exportResults('json');
                log(`📥 Test results exported: ${filename}`);
            } else {
                log('⚠️ No test results to export');
            }
        }

        function analyzeCoverage() {
            // Simulate coverage analysis
            const functionCoverage = Math.floor(Math.random() * 40) + 60; // 60-100%
            const lineCoverage = Math.floor(Math.random() * 30) + 70; // 70-100%
            const branchCoverage = Math.floor(Math.random() * 50) + 50; // 50-100%
            
            document.getElementById('function-coverage').textContent = `${functionCoverage}%`;
            document.getElementById('function-coverage-bar').style.width = `${functionCoverage}%`;
            
            document.getElementById('line-coverage').textContent = `${lineCoverage}%`;
            document.getElementById('line-coverage-bar').style.width = `${lineCoverage}%`;
            
            document.getElementById('branch-coverage').textContent = `${branchCoverage}%`;
            document.getElementById('branch-coverage-bar').style.width = `${branchCoverage}%`;
            
            const overallCoverage = Math.round((functionCoverage + lineCoverage + branchCoverage) / 3);
            document.getElementById('coverage-percentage').textContent = `${overallCoverage}%`;
            document.getElementById('coverage-fill').style.width = `${overallCoverage}%`;
            
            log(`📊 Coverage analysis: ${overallCoverage}% overall coverage`);
        }

        function clearTestResults() {
            testResults = {
                unit: { total: 0, passed: 0, failed: 0, skipped: 0 },
                integration: { total: 0, passed: 0, failed: 0, skipped: 0 },
                e2e: { total: 0, passed: 0, failed: 0, skipped: 0 },
                performance: { total: 0, passed: 0, failed: 0, skipped: 0 },
                accessibility: { total: 0, passed: 0, failed: 0, skipped: 0 }
            };
            
            updateTotalMetrics();
            updateProgress(0, 'Test results cleared');
            log('🗑️ Test results cleared');
        }

        // UI update functions
        function updateSuiteMetrics(suiteName, results) {
            document.getElementById(`${suiteName}-total`).textContent = results.total;
            document.getElementById(`${suiteName}-passed`).textContent = results.passed;
        }

        function updateTotalMetrics() {
            const totals = calculateTotalMetrics();
            
            document.getElementById('total-tests').textContent = totals.total;
            document.getElementById('total-passed').textContent = totals.passed;
            document.getElementById('total-failed').textContent = totals.failed;
            document.getElementById('total-skipped').textContent = totals.skipped;
            document.getElementById('pass-rate').textContent = `${totals.passRate}%`;
        }

        function calculateTotalMetrics() {
            const totals = { total: 0, passed: 0, failed: 0, skipped: 0 };
            
            Object.values(testResults).forEach(suite => {
                totals.total += suite.total || 0;
                totals.passed += suite.passed || 0;
                totals.failed += suite.failed || 0;
                totals.skipped += suite.skipped || 0;
            });
            
            totals.passRate = totals.total > 0 ? Math.round((totals.passed / totals.total) * 100) : 0;
            
            return totals;
        }

        function updateProgress(percentage, text) {
            document.getElementById('test-progress').style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = text;
            
            const totals = calculateTotalMetrics();
            document.getElementById('progress-stats').textContent = 
                `${totals.passed + totals.failed + totals.skipped}/${totals.total} tests completed`;
        }

        function toggleTestRunner() {
            // Create test runner if it doesn't exist
            let testRunner = document.getElementById('test-runner');
            
            if (!testRunner) {
                testRunner = document.createElement('div');
                testRunner.id = 'test-runner';
                testRunner.className = 'test-runner';
                testRunner.innerHTML = `
                    <div class="test-runner-header">
                        <h2 class="test-runner-title">
                            🧪 Test Runner
                            <button class="test-runner-close" onclick="toggleTestRunner()">×</button>
                        </h2>
                    </div>
                    <div class="test-runner-controls">
                        <div class="test-control-group">
                            <h4>Test Suites</h4>
                            <div class="test-suite-toggle">
                                <div class="test-suite-checkbox checked" onclick="toggleSuite(this, 'unit')"></div>
                                <span class="test-suite-label">Unit Tests</span>
                            </div>
                            <div class="test-suite-toggle">
                                <div class="test-suite-checkbox checked" onclick="toggleSuite(this, 'integration')"></div>
                                <span class="test-suite-label">Integration Tests</span>
                            </div>
                            <div class="test-suite-toggle">
                                <div class="test-suite-checkbox checked" onclick="toggleSuite(this, 'e2e')"></div>
                                <span class="test-suite-label">End-to-End Tests</span>
                            </div>
                            <div class="test-suite-toggle">
                                <div class="test-suite-checkbox checked" onclick="toggleSuite(this, 'performance')"></div>
                                <span class="test-suite-label">Performance Tests</span>
                            </div>
                            <div class="test-suite-toggle">
                                <div class="test-suite-checkbox checked" onclick="toggleSuite(this, 'accessibility')"></div>
                                <span class="test-suite-label">Accessibility Tests</span>
                            </div>
                        </div>
                        
                        <button class="test-run-button" onclick="runAllTests()">
                            Run Selected Tests
                        </button>
                    </div>
                    <div class="test-results" id="test-runner-results">
                        <div class="test-summary">
                            <h3>Test Results</h3>
                            <p>Run tests to see results here</p>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(testRunner);
            }
            
            testRunner.classList.toggle('open');
            log('🧪 Test runner toggled');
        }

        function toggleSuite(checkbox, suiteName) {
            checkbox.classList.toggle('checked');
            
            if (testingFramework) {
                const configKey = `enable${suiteName.charAt(0).toUpperCase() + suiteName.slice(1)}Tests`;
                testingFramework.config[configKey] = checkbox.classList.contains('checked');
            }
        }

        function log(message) {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeTestingFramework();
            
            // Simulate some initial metrics
            setTimeout(() => {
                document.getElementById('page-load-time').textContent = '1.2s';
                document.getElementById('api-response-time').textContent = '450ms';
                document.getElementById('accessibility-score').textContent = '92';
                analyzeCoverage();
            }, 1000);
        });

        // Add some automatic test execution for demo
        setTimeout(() => {
            if (Math.random() < 0.3) { // 30% chance to auto-run some tests
                log('🤖 Auto-running sample tests for demonstration...');
                setTimeout(() => {
                    runUnitTests();
                }, 2000);
            }
        }, 5000);
    </script>
</body>
</html>