<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Stream Images - BlueandCosmos</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --accent: #0033a0;
      --flag-blue: #002366;
      --highlight: #ff4081;
      --text-white: #ffffff;
      --text-light: #cce0ff;
      --dark-bg: #121212;
      --dark-accent: #001f5b;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Work Sans', sans-serif;
      background: #fff;
      color: #000;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    body.dark { background-color: var(--dark-bg); color: var(--text-white); }
    main { flex: 1 0 auto; }
    :focus-visible { outline: 2px dashed var(--highlight); outline-offset: 2px; }

    header {
      background: var(--accent);
      color: var(--text-white);
      padding: 1em 2em;
      display: grid;
      grid-template-columns: auto 1fr auto auto auto;
      align-items: center;
      gap: 1.5em;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .logo-link { display: flex; align-items: center; text-decoration: none; color: inherit; }
    .logo-area { display: flex; align-items: center; gap: 0.4em; }
    .logo-area img { height: 50px; width: 50px; margin: 0; padding: 0; background-color: transparent; display: block; }
    .logo-text { display: flex; flex-direction: column; line-height: 1.2; margin-left: -4px; }
    .logo-text .title { font-size: 1.4em; font-weight: bold; color: #fff; margin: 0; }
    .logo-text .tagline { font-size: 0.85em; color: var(--text-light); margin: 0; }

    .nav-right {
      display: flex; align-items: center; justify-content: flex-end; gap: 1.2em;
    }
    .nav-right > * { display: inline-flex; align-items: center; }

    .moon-widget {
      display: flex; align-items: center; gap: 0.6em; justify-self: center;
      min-width: 220px; user-select: none; text-decoration: none; color: inherit;
    }
    .moon-icon { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
    .moon-info { display: flex; flex-direction: column; gap: 0.1em; }
    .moon-label { color: var(--text-light); font-size: 0.95em; white-space: nowrap; font-weight: 500; }
    .moon-context { color: var(--text-light); font-size: 0.75em; opacity: 0.8; white-space: nowrap; }
    body.dark .moon-label, body.dark .moon-context { color: #e0ecff; }
    @media (max-width: 900px) { .moon-widget { display: none; } }

    .mars-widget {
      display: flex; align-items: center; gap: 0.6em; justify-self: center;
      user-select: none; text-decoration: none; color: inherit;
      transition: transform 0.2s ease;
    }
    .mars-label {
      color: var(--text-light); 
      font-size: 0.95em; 
      font-weight: 600; 
      white-space: nowrap;
    }
    body.dark .mars-label { color: #e0ecff; }
    .mars-widget:hover { transform: scale(1.05); }
    .mars-icon { 
      width: 32px; height: 32px; border-radius: 50%; 
      background-image: url('https://photojournal.jpl.nasa.gov/jpeg/PIA00407.jpg');
      background-size: cover;
      background-position: center;
      display: flex; align-items: center; justify-content: center; 
      flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(205, 92, 92, 0.4);
      border: 2px solid rgba(205, 92, 92, 0.3);
    }
    @media (max-width: 1100px) { .mars-widget { display: none; } }

    nav { display: contents; }
    .dropdown { position: relative; }
    .dropbtn {
      background: none; border: none; font-size: 1em; color: #fff;
      cursor: pointer; padding: 0.4em 0; position: relative;
      text-decoration: none; display: inline-block;
    }
    .dropbtn:hover, .dropbtn:focus { color: var(--highlight); }
    .dropbtn::after {
      content: ""; position: absolute; left: 0; bottom: -2px;
      width: 0; height: 2px; background: var(--highlight);
      transition: width 0.25s ease-in-out;
    }
    .dropdown:hover > .dropbtn::after,
    .dropbtn:focus::after,
    .dropdown.open > .dropbtn::after { width: 100%; }
    .dropdown-content {
      display: none; position: absolute; top: calc(100% + 0.6em); left: 0;
      background: var(--accent); min-width: 220px;
      flex-direction: column; box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      z-index: 1001; padding: 0.3em 0; border-radius: 6px;
    }
    .dropdown:hover .dropdown-content,
    .dropdown:focus-within .dropdown-content,
    .dropdown.open .dropdown-content { display: flex; }
    .dropdown-content a {
      color: var(--text-light); text-decoration: none;
      padding: 0.8em 1em; position: relative;
      transition: color 0.2s ease, background-color 0.2s ease, transform 0.15s ease;
    }
    .dropdown-content a:hover,
    .dropdown-content a:focus,
    .dropdown-content a.clicked {
      background-color: var(--flag-blue); color: #fff !important; transform: translateX(5px);
    }
    .dropdown-content a::after {
      content: ""; position: absolute; left: 1em; bottom: 6px;
      width: 0; height: 2px; background: var(--highlight);
      transition: width 0.25s ease;
    }
    .dropdown-content a:hover::after,
    .dropdown-content a:focus::after,
    .dropdown-content a.clicked::after { width: calc(100% - 2em); }
    body.dark .dropdown-content a { color: #d9e6ff; }

    .nav-link { color: #fff; text-decoration: none; position: relative; padding-bottom: 2px; }
    .nav-link:hover { color: var(--highlight); }
    .nav-link::after {
      content: ""; position: absolute; left: 0; bottom: -2px;
      width: 0; height: 2px; background: var(--highlight);
      transition: width 0.25s ease-in-out;
    }
    .nav-link:hover::after { width: 100%; }

    .toggle-theme { cursor: pointer; font-size: 1.5em; line-height: 1; user-select: none; }

    body.dark header, body.dark footer { background-color: var(--dark-accent); }
    body.dark .dropbtn, body.dark .nav-link { color: #e6f0ff; }

    /* Livestream-specific styles */
    .livestream-container {
      padding: 2em;
      max-width: 1400px;
      margin: 0 auto;
    }

    .page-header {
      text-align: center;
      margin-bottom: 2em;
    }

    .page-title {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 0.5em;
      background: linear-gradient(135deg, var(--accent), var(--highlight));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .page-subtitle {
      font-size: 1.2em;
      color: var(--text-light);
      margin-bottom: 1em;
    }

    body.dark .page-subtitle {
      color: #cce0ff;
    }

    /* Controls Bar Styles */
    .controls-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2em;
      padding: 1.5em;
      background: rgba(0, 51, 160, 0.05);
      border-radius: 12px;
      border: 1px solid rgba(0, 51, 160, 0.1);
      flex-wrap: wrap;
      gap: 1em;
    }

    body.dark .controls-bar {
      background: rgba(0, 31, 91, 0.2);
      border-color: rgba(0, 31, 91, 0.3);
    }

    .filter-controls {
      display: flex;
      gap: 0.5em;
      flex-wrap: wrap;
    }

    .filter-btn {
      background: #fff;
      border: 2px solid var(--accent);
      color: var(--accent);
      padding: 0.5em 1em;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 500;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .filter-btn:hover,
    .filter-btn:focus {
      background: var(--accent);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 51, 160, 0.2);
    }

    .filter-btn.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 2px 4px rgba(0, 51, 160, 0.3);
    }

    body.dark .filter-btn {
      background: var(--dark-bg);
      border-color: var(--text-light);
      color: var(--text-light);
    }

    body.dark .filter-btn:hover,
    body.dark .filter-btn:focus,
    body.dark .filter-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .view-controls {
      display: flex;
      gap: 0.3em;
      background: #fff;
      border-radius: 8px;
      padding: 0.2em;
      border: 1px solid #ddd;
    }

    body.dark .view-controls {
      background: var(--dark-bg);
      border-color: #444;
    }

    .view-btn {
      background: transparent;
      border: none;
      padding: 0.5em 0.8em;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.1em;
      transition: all 0.2s ease;
      color: #666;
    }

    .view-btn:hover,
    .view-btn:focus {
      background: rgba(0, 51, 160, 0.1);
      color: var(--accent);
    }

    .view-btn.active {
      background: var(--accent);
      color: white;
    }

    body.dark .view-btn {
      color: #aaa;
    }

    body.dark .view-btn:hover,
    body.dark .view-btn:focus {
      background: rgba(0, 51, 160, 0.2);
      color: var(--text-light);
    }

    .refresh-indicator {
      display: flex;
      align-items: center;
      gap: 0.8em;
      font-size: 0.9em;
      color: #666;
    }

    body.dark .refresh-indicator {
      color: #aaa;
    }

    .last-updated {
      font-style: italic;
    }

    .refresh-btn {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.2s ease;
    }

    .refresh-btn:hover,
    .refresh-btn:focus {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      transform: rotate(180deg);
    }

    .refresh-btn.spinning {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    body.dark .refresh-btn {
      background: var(--dark-bg);
      border-color: #444;
      color: #aaa;
    }

    body.dark .refresh-btn:hover,
    body.dark .refresh-btn:focus {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    /* Image Gallery Grid Layout */
    .image-gallery {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 2em;
      transition: all 0.3s ease;
    }

    /* List View Layout */
    .image-gallery.list-view {
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .image-gallery.list-view .image-card {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 1.5em;
      align-items: start;
    }

    .image-gallery.list-view .image-container {
      aspect-ratio: 16/9;
      width: 100%;
    }

    .image-gallery.list-view .image-info {
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
    }

    .image-gallery.list-view .image-title {
      font-size: 1.3em;
      margin-bottom: 0.8em;
    }

    .image-gallery.list-view .image-description {
      -webkit-line-clamp: 4;
      margin-bottom: 1.5em;
    }

    @media (max-width: 768px) {
      .image-gallery.list-view .image-card {
        grid-template-columns: 1fr;
        gap: 1em;
      }
      
      .image-gallery.list-view .image-info {
        padding: 1em;
      }
    }

    /* Fade in animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Loading message styles */
    .loading-message {
      grid-column: 1 / -1;
      text-align: center;
      padding: 4em 2em;
      font-size: 1.1em;
      color: #666;
      background: linear-gradient(135deg, rgba(0, 51, 160, 0.05), rgba(255, 64, 129, 0.05));
      border-radius: 12px;
      border: 2px dashed rgba(0, 51, 160, 0.2);
    }

    body.dark .loading-message {
      color: #ccc;
      background: linear-gradient(135deg, rgba(0, 31, 91, 0.2), rgba(255, 64, 129, 0.1));
      border-color: rgba(0, 31, 91, 0.3);
    }

    /* Error message styles */
    .error-message {
      grid-column: 1 / -1;
      text-align: center;
      padding: 2em;
      background: rgba(255, 64, 129, 0.1);
      border: 2px dashed var(--highlight);
      border-radius: 12px;
      color: #d63384;
    }

    body.dark .error-message {
      background: rgba(255, 64, 129, 0.2);
      color: #ff6b9d;
    }

    /* Responsive breakpoints */
    @media (max-width: 1200px) {
      .image-gallery {
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
      }
    }

    @media (max-width: 768px) {
      .image-gallery {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
    }

    @media (max-width: 480px) {
      .image-gallery {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }

    /* Image Card Styles */
    .image-card {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
    }

    .image-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    body.dark .image-card {
      background: #1a1a1a;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    body.dark .image-card:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    .image-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      overflow: hidden;
    }

    .image-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .image-card:hover .image-container img {
      transform: scale(1.05);
    }

    .image-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.7) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      display: flex;
      align-items: flex-end;
      justify-content: flex-end;
      padding: 1em;
      gap: 0.5em;
    }

    .image-card:hover .image-overlay {
      opacity: 1;
    }

    .overlay-btn {
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2em;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
    }

    .overlay-btn:hover,
    .overlay-btn:focus {
      background: #fff;
      transform: scale(1.1);
      outline: 2px solid var(--highlight);
      outline-offset: 2px;
    }

    .overlay-btn:active {
      transform: scale(0.95);
    }

    /* Improve image loading states */
    .image-container img {
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .image-container img[data-src] {
      opacity: 0.7;
    }

    .image-container img:not([data-src]) {
      opacity: 1;
    }

    .image-info {
      padding: 1.2em;
    }

    .image-title {
      font-size: 1.1em;
      font-weight: bold;
      margin: 0 0 0.5em 0;
      color: #333;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    body.dark .image-title {
      color: #fff;
    }

    .image-description {
      font-size: 0.9em;
      color: #666;
      margin: 0 0 1em 0;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    body.dark .image-description {
      color: #ccc;
    }

    .image-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8em;
      color: #888;
    }

    body.dark .image-meta {
      color: #aaa;
    }

    .source {
      color: white;
      padding: 0.2em 0.6em;
      border-radius: 12px;
      font-weight: 500;
      text-transform: uppercase;
      font-size: 0.75em;
    }

    /* Source-specific colors */
    .source:contains("NASA"),
    [data-source="nasa"] .source {
      background: var(--accent);
    }

    [data-source="spacex"] .source {
      background: #005288;
    }

    [data-source="iss"] .source {
      background: #28a745;
    }

    [data-source="esa"] .source {
      background: #6f42c1;
    }

    .timestamp {
      font-style: italic;
    }

    /* Loading Skeleton Animations */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    body.dark .skeleton {
      background: linear-gradient(90deg, #2a2a2a 25%, #3a3a3a 50%, #2a2a2a 75%);
      background-size: 200% 100%;
    }

    @keyframes loading {
      0% {
        background-position: 200% 0;
      }
      100% {
        background-position: -200% 0;
      }
    }

    .skeleton-card {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    body.dark .skeleton-card {
      background: #1a1a1a;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .skeleton-image {
      width: 100%;
      aspect-ratio: 16/9;
    }

    .skeleton-content {
      padding: 1.2em;
    }

    .skeleton-title {
      height: 1.2em;
      border-radius: 4px;
      margin-bottom: 0.5em;
    }

    .skeleton-description {
      height: 0.9em;
      border-radius: 4px;
      margin-bottom: 0.3em;
    }

    .skeleton-description:last-of-type {
      width: 70%;
      margin-bottom: 1em;
    }

    .skeleton-meta {
      display: flex;
      justify-content: space-between;
    }

    .skeleton-source {
      width: 60px;
      height: 1.2em;
      border-radius: 12px;
    }

    .skeleton-timestamp {
      width: 80px;
      height: 1em;
      border-radius: 4px;
    }

    .placeholder-content {
      text-align: center;
      padding: 4em 2em;
      background: linear-gradient(135deg, rgba(0, 51, 160, 0.1), rgba(255, 64, 129, 0.1));
      border-radius: 12px;
      border: 2px dashed var(--accent);
    }

    .placeholder-icon {
      font-size: 4em;
      margin-bottom: 1em;
    }

    .placeholder-text {
      font-size: 1.1em;
      color: #666;
      line-height: 1.6;
    }

    body.dark .placeholder-content {
      background: linear-gradient(135deg, rgba(0, 31, 91, 0.3), rgba(255, 64, 129, 0.1));
      border-color: var(--dark-accent);
    }

    body.dark .placeholder-text {
      color: #ccc;
    }

    footer {
      background-color: var(--accent);
      color: #fff;
      padding: 2em 1em;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      text-align: center;
      gap: 1em;
    }
    footer a { color: #fff; text-decoration: none; }
    footer a:hover { text-decoration: underline; }

    @media (max-width: 768px) {
      .livestream-container {
        padding: 1em;
      }
      
      .page-title {
        font-size: 2em;
      }
      
      .page-subtitle {
        font-size: 1em;
      }

      .image-info {
        padding: 1em;
      }

      .image-title {
        font-size: 1em;
      }

      .image-description {
        font-size: 0.85em;
        -webkit-line-clamp: 2;
      }

      .overlay-btn {
        width: 36px;
        height: 36px;
        font-size: 1em;
      }
    }

    @media (max-width: 768px) {
      .controls-bar {
        flex-direction: column;
        align-items: stretch;
        gap: 1.5em;
      }

      .filter-controls {
        justify-content: center;
      }

      .view-controls,
      .refresh-indicator {
        align-self: center;
      }
    }

    @media (max-width: 480px) {
      .page-header {
        margin-bottom: 1.5em;
      }

      .page-title {
        font-size: 1.8em;
      }

      .image-info {
        padding: 0.8em;
      }

      .image-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.3em;
      }

      .controls-bar {
        padding: 1em;
      }

      .filter-btn {
        font-size: 0.8em;
        padding: 0.4em 0.8em;
      }
    }
  </style>
</head>

<body>
  <header>
    <a href="index.html" class="logo-link" aria-label="BlueandCosmos Home">
      <div class="logo-area">
        <img src="https://cdn.jsdelivr.net/gh/swetharajan7/blueandcosmos/assets/logo-transparent.png" alt="BlueandCosmos Logo" />
        <div class="logo-text">
          <div class="title">BlueandCosmos</div>
          <div class="tagline">Exploring the Cosmos. Protecting the Earth.</div>
        </div>
      </div>
    </a>

    <a href="moon.html" class="moon-widget" title="View detailed moon phase information">
      <div class="moon-icon" id="moon-display">🌙</div>
      <div class="moon-info">
        <span class="moon-label">Loading moon phase…</span>
        <span class="moon-context" id="moon-context">New York City, NY</span>
      </div>
    </a>

    <a href="mars.html" class="mars-widget" title="Explore Mars - The Red Planet">
      <div class="mars-icon"></div>
      <span class="mars-label">MARS</span>
    </a>

    <nav>
      <div class="nav-right">
        <!-- About (internal links, same tab) -->
        <div class="dropdown" data-menu="about">
          <button class="dropbtn">About</button>
          <div class="dropdown-content" role="menu" aria-label="About submenu">
            <a href="about.html" role="menuitem">About BlueandCosmos</a>
          </div>
        </div>

        <!-- Livestream (internal placeholders as relative links) -->
        <div class="dropdown" data-menu="livestream">
          <button class="dropbtn">Livestream</button>
          <div class="dropdown-content" role="menu" aria-label="Livestream submenu">
            <a href="livestream-images.html" role="menuitem" class="clicked">Live Stream Images</a>
            <a href="launch-missions.html" role="menuitem">Launch Missions</a>
            <a href="webinars.html" role="menuitem">Webinars</a>
          </div>
        </div>

        <!-- Dashboard (educational tools and features) -->
        <div class="dropdown" data-menu="dashboard">
          <a href="dashboard.html" class="dropbtn">Dashboard</a>
          <div class="dropdown-content" role="menu" aria-label="Dashboard submenu">
            <a href="moon.html" role="menuitem">🌙 Lunar Intelligence Center</a>
            <a href="telescope.html" role="menuitem">🔭 Telescope</a>
            <a href="flashcards.html" role="menuitem">🧠 Flashcards</a>
            <a href="stellarrec.html" role="menuitem">⭐ StellarRec</a>
            <a href="discussion.html" role="menuitem">💬 Community</a>
          </div>
        </div>
        <div class="toggle-theme" id="themeToggle">🌙</div>
      </div>
    </nav>
  </header>

  <main class="livestream-container">
    <div class="page-header">
      <h1 class="page-title">Live Stream Images</h1>
      <p class="page-subtitle">Real-time space imagery from missions, observatories, and cosmic events</p>
    </div>

    <!-- Controls Bar -->
    <section class="controls-bar">
      <div class="filter-controls">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="missions">Missions</button>
        <button class="filter-btn" data-filter="deep-space">Deep Space</button>
        <button class="filter-btn" data-filter="earth">Earth</button>
        <button class="filter-btn" data-filter="planets">Planets</button>
        <button class="filter-btn" data-filter="iss">ISS</button>
      </div>
      <div class="view-controls">
        <button class="view-btn active" data-view="grid" title="Grid View">⊞</button>
        <button class="view-btn" data-view="list" title="List View">☰</button>
      </div>
      <div class="refresh-indicator">
        <span class="last-updated">Updated: <time id="last-refresh">just now</time></span>
        <button class="refresh-btn" title="Refresh Now">🔄</button>
      </div>
    </section>

    <!-- Image Gallery Grid -->
    <section class="image-gallery" id="image-gallery">
      <!-- Sample Image Cards with Real Space Imagery -->
      <article class="image-card" data-category="missions" data-source="nasa">
        <div class="image-container">
          <img src="https://images-assets.nasa.gov/image/PIA24546/PIA24546~thumb.jpg" 
               alt="Perseverance Mars Rover Self-Portrait" 
               loading="lazy">
          <div class="image-overlay">
            <button class="overlay-btn expand-btn" title="View Full Size">🔍</button>
            <button class="overlay-btn share-btn" title="Share Image">📤</button>
          </div>
        </div>
        <div class="image-info">
          <h3 class="image-title">Perseverance Mars Rover Self-Portrait</h3>
          <p class="image-description">NASA's Perseverance rover took this selfie over a rock nicknamed "Rochette," on Sol 198 (September 10, 2021). The rover is preparing to take its first sample from this rock.</p>
          <div class="image-meta">
            <span class="source">NASA</span>
            <time class="timestamp">2 hours ago</time>
          </div>
        </div>
      </article>

      <article class="image-card" data-category="deep-space" data-source="nasa">
        <div class="image-container">
          <img src="https://images-assets.nasa.gov/image/PIA23122/PIA23122~thumb.jpg" 
               alt="Hubble Views the Crab Nebula" 
               loading="lazy">
          <div class="image-overlay">
            <button class="overlay-btn expand-btn" title="View Full Size">🔍</button>
            <button class="overlay-btn share-btn" title="Share Image">📤</button>
          </div>
        </div>
        <div class="image-info">
          <h3 class="image-title">Hubble Views the Crab Nebula</h3>
          <p class="image-description">This Hubble Space Telescope image shows the Crab Nebula, the result of a supernova explosion that was observed by Chinese astronomers in 1054 AD.</p>
          <div class="image-meta">
            <span class="source">NASA</span>
            <time class="timestamp">4 hours ago</time>
          </div>
        </div>
      </article>

      <article class="image-card" data-category="earth" data-source="iss">
        <div class="image-container">
          <img src="https://images-assets.nasa.gov/image/iss066e013602/iss066e013602~thumb.jpg" 
               alt="Earth from the International Space Station" 
               loading="lazy">
          <div class="image-overlay">
            <button class="overlay-btn expand-btn" title="View Full Size">🔍</button>
            <button class="overlay-btn share-btn" title="Share Image">📤</button>
          </div>
        </div>
        <div class="image-info">
          <h3 class="image-title">Earth from the International Space Station</h3>
          <p class="image-description">A stunning view of Earth's curvature and atmosphere captured from the International Space Station, showing the thin blue line of our planet's protective atmosphere.</p>
          <div class="image-meta">
            <span class="source">ISS</span>
            <time class="timestamp">1 hour ago</time>
          </div>
        </div>
      </article>

      <article class="image-card" data-category="planets" data-source="nasa">
        <div class="image-container">
          <img src="https://images-assets.nasa.gov/image/PIA21773/PIA21773~thumb.jpg" 
               alt="Jupiter's Great Red Spot" 
               loading="lazy">
          <div class="image-overlay">
            <button class="overlay-btn expand-btn" title="View Full Size">🔍</button>
            <button class="overlay-btn share-btn" title="Share Image">📤</button>
          </div>
        </div>
        <div class="image-info">
          <h3 class="image-title">Jupiter's Great Red Spot</h3>
          <p class="image-description">This enhanced-color image of Jupiter's Great Red Spot was created by citizen scientist Gerald Eichstädt using data from Juno's JunoCam imager.</p>
          <div class="image-meta">
            <span class="source">NASA</span>
            <time class="timestamp">6 hours ago</time>
          </div>
        </div>
      </article>

      <article class="image-card" data-category="missions" data-source="spacex">
        <div class="image-container">
          <img src="https://images-assets.nasa.gov/image/KSC-20200530-PH-SPX01_0005/KSC-20200530-PH-SPX01_0005~thumb.jpg" 
               alt="SpaceX Falcon 9 Launch" 
               loading="lazy">
          <div class="image-overlay">
            <button class="overlay-btn expand-btn" title="View Full Size">🔍</button>
            <button class="overlay-btn share-btn" title="Share Image">📤</button>
          </div>
        </div>
        <div class="image-info">
          <h3 class="image-title">SpaceX Falcon 9 Launch</h3>
          <p class="image-description">A SpaceX Falcon 9 rocket carrying NASA astronauts Doug Hurley and Bob Behnken in the Crew Dragon spacecraft lifts off from Launch Complex 39A.</p>
          <div class="image-meta">
            <span class="source">SPACEX</span>
            <time class="timestamp">3 hours ago</time>
          </div>
        </div>
      </article>

      <article class="image-card" data-category="deep-space" data-source="nasa">
        <div class="image-container">
          <img src="https://images-assets.nasa.gov/image/PIA24825/PIA24825~thumb.jpg" 
               alt="Webb's First Deep Field" 
               loading="lazy">
          <div class="image-overlay">
            <button class="overlay-btn expand-btn" title="View Full Size">🔍</button>
            <button class="overlay-btn share-btn" title="Share Image">📤</button>
          </div>
        </div>
        <div class="image-info">
          <h3 class="image-title">Webb's First Deep Field</h3>
          <p class="image-description">NASA's James Webb Space Telescope has delivered the deepest and sharpest infrared image of the distant universe so far, showing galaxy cluster SMACS 0723.</p>
          <div class="image-meta">
            <span class="source">NASA</span>
            <time class="timestamp">5 hours ago</time>
          </div>
        </div>
      </article>

      <article class="image-card" data-category="planets" data-source="nasa">
        <div class="image-container">
          <img src="https://images-assets.nasa.gov/image/PIA23791/PIA23791~thumb.jpg" 
               alt="Saturn's Rings in Infrared" 
               loading="lazy">
          <div class="image-overlay">
            <button class="overlay-btn expand-btn" title="View Full Size">🔍</button>
            <button class="overlay-btn share-btn" title="Share Image">📤</button>
          </div>
        </div>
        <div class="image-info">
          <h3 class="image-title">Saturn's Rings in Infrared</h3>
          <p class="image-description">This infrared image from NASA's Cassini spacecraft shows Saturn's rings in exquisite detail, revealing the complex structure and composition of the ring system.</p>
          <div class="image-meta">
            <span class="source">NASA</span>
            <time class="timestamp">8 hours ago</time>
          </div>
        </div>
      </article>

      <article class="image-card" data-category="iss" data-source="iss">
        <div class="image-container">
          <img src="https://images-assets.nasa.gov/image/iss066e054063/iss066e054063~thumb.jpg" 
               alt="Aurora from Space" 
               loading="lazy">
          <div class="image-overlay">
            <button class="overlay-btn expand-btn" title="View Full Size">🔍</button>
            <button class="overlay-btn share-btn" title="Share Image">📤</button>
          </div>
        </div>
        <div class="image-info">
          <h3 class="image-title">Aurora from Space</h3>
          <p class="image-description">A spectacular aurora borealis captured from the International Space Station, showing the dancing lights of charged particles interacting with Earth's magnetic field.</p>
          <div class="image-meta">
            <span class="source">ISS</span>
            <time class="timestamp">30 minutes ago</time>
          </div>
        </div>
      </article>
    </section>
  </main>

  <footer>
    <div style="flex:1;display:flex;flex-direction:column;align-items:flex-start;gap:0.5em;">
      <a href="#"><img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" alt="Google Play Store" style="height:40px;"></a>
      <a href="#"><img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg" alt="Apple Store" style="height:40px;"></a>
    </div>

    <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:0.5em;">
      <div style="font-weight:bold;">BlueandCosmos™ 2025</div>
      <div style="display:flex;flex-wrap:wrap;gap:1em;justify-content:center;font-size:0.9em;">
        <a href="privacy.html">Privacy Policy</a>
        <a href="terms.html">Terms of Use</a>
        <a href="sitemap.html">Sitemap</a>
      </div>
    </div>

    <div style="flex:1;display:flex;flex-direction:column;align-items:flex-end;gap:0.5em;">
      <div style="font-weight:bold;">Let's Connect!</div>
      <div style="display:flex;gap:0.5em;">
        <a href="https://twitter.com/blueandcosmos" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg" alt="X" style="height:24px;filter:invert(1);"></a>
        <a href="https://instagram.com/blueandcosmos" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram" style="height:24px;filter:invert(1);"></a>
        <a href="https://tiktok.com/@blueandcosmos" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok" style="height:24px;filter:invert(1);"></a>
        <a href="https://youtube.com/@blueandcosmos" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YouTube" style="height:24px;filter:invert(1);"></a>
      </div>
    </div>
  </footer>

  <script src="maximus.js"></script>
  <script>
    // Image Data Management System
    class ImageDataManager {
      constructor() {
        this.cache = new Map();
        this.cacheExpiry = 5 * 60 * 1000; // 5 minutes
        this.retryAttempts = 3;
        this.retryDelay = 1000; // 1 second
      }

      // Main method to fetch all images from multiple sources
      async fetchAllImages() {
        const sources = [
          this.fetchNASAImages(),
          this.fetchESAImages(),
          this.fetchSpaceXImages(),
          this.fetchISSImages(),
          this.fetchAPOD()
        ];

        try {
          const results = await Promise.allSettled(sources);
          const allImages = [];

          results.forEach((result, index) => {
            if (result.status === 'fulfilled' && result.value) {
              if (Array.isArray(result.value)) {
                allImages.push(...result.value);
              } else {
                allImages.push(result.value);
              }
            } else {
              console.warn(`Source ${index} failed:`, result.reason);
            }
          });

          return this.combineAndSort(allImages);
        } catch (error) {
          console.error('Error fetching images:', error);
          return this.getFallbackImages();
        }
      }

      // NASA Image and Video Library API
      async fetchNASAImages() {
        const cacheKey = 'nasa_images';
        const cached = this.getFromCache(cacheKey);
        if (cached) return cached;

        try {
          // Using NASA's Image and Video Library API
          const response = await this.fetchWithRetry(
            'https://images-api.nasa.gov/search?q=space&media_type=image&page_size=20'
          );
          
          if (!response.ok) throw new Error(`NASA API error: ${response.status}`);
          
          const data = await response.json();
          const images = data.collection.items.map(item => this.parseNASAImage(item));
          
          this.setCache(cacheKey, images);
          return images;
        } catch (error) {
          console.error('NASA API error:', error);
          return this.getNASAFallback();
        }
      }

      // Parse NASA API response to our SpaceImage format
      parseNASAImage(item) {
        const data = item.data[0];
        const links = item.links || [];
        const imageLink = links.find(link => link.rel === 'preview');
        
        return {
          id: `nasa_${data.nasa_id}`,
          title: data.title || 'NASA Image',
          description: data.description || 'Image from NASA',
          imageUrl: imageLink ? imageLink.href : this.getPlaceholderImage(),
          thumbnailUrl: imageLink ? imageLink.href : this.getPlaceholderImage(),
          source: 'nasa',
          category: this.categorizeNASAImage(data),
          timestamp: new Date(data.date_created || Date.now()),
          sourceUrl: `https://images.nasa.gov/details-${data.nasa_id}`,
          metadata: {
            photographer: data.photographer,
            center: data.center,
            keywords: data.keywords
          }
        };
      }

      // Categorize NASA images based on content
      categorizeNASAImage(data) {
        const title = (data.title || '').toLowerCase();
        const description = (data.description || '').toLowerCase();
        const keywords = (data.keywords || []).join(' ').toLowerCase();
        const content = `${title} ${description} ${keywords}`;

        if (content.includes('mars') || content.includes('rover') || content.includes('mission')) {
          return 'missions';
        } else if (content.includes('earth') || content.includes('planet earth')) {
          return 'earth';
        } else if (content.includes('jupiter') || content.includes('saturn') || content.includes('planet')) {
          return 'planets';
        } else if (content.includes('nebula') || content.includes('galaxy') || content.includes('star')) {
          return 'deep-space';
        } else if (content.includes('iss') || content.includes('space station')) {
          return 'iss';
        }
        return 'missions'; // default
      }

      // ESA Images (European Space Agency)
      async fetchESAImages() {
        const cacheKey = 'esa_images';
        const cached = this.getFromCache(cacheKey);
        if (cached) return cached;

        // ESA doesn't have a public API, so we'll use curated content
        const images = this.getESAFallback();
        this.setCache(cacheKey, images);
        return images;
      }

      // SpaceX API
      async fetchSpaceXImages() {
        const cacheKey = 'spacex_images';
        const cached = this.getFromCache(cacheKey);
        if (cached) return cached;

        try {
          const response = await this.fetchWithRetry('https://api.spacexdata.com/v4/launches/latest');
          
          if (!response.ok) throw new Error(`SpaceX API error: ${response.status}`);
          
          const launch = await response.json();
          const images = this.parseSpaceXLaunch(launch);
          
          this.setCache(cacheKey, images);
          return images;
        } catch (error) {
          console.error('SpaceX API error:', error);
          return this.getSpaceXFallback();
        }
      }

      // Parse SpaceX launch data
      parseSpaceXLaunch(launch) {
        const images = [];
        
        if (launch.links && launch.links.flickr && launch.links.flickr.original) {
          launch.links.flickr.original.forEach((imageUrl, index) => {
            images.push({
              id: `spacex_${launch.id}_${index}`,
              title: `${launch.name} Launch`,
              description: launch.details || `SpaceX ${launch.name} mission launch`,
              imageUrl: imageUrl,
              thumbnailUrl: imageUrl,
              source: 'spacex',
              category: 'missions',
              timestamp: new Date(launch.date_utc),
              sourceUrl: launch.links.webcast || 'https://www.spacex.com',
              metadata: {
                mission: launch.name,
                rocket: launch.rocket,
                success: launch.success
              }
            });
          });
        }
        
        return images.length > 0 ? images : this.getSpaceXFallback();
      }

      // ISS Images (simulated real-time feed)
      async fetchISSImages() {
        const cacheKey = 'iss_images';
        const cached = this.getFromCache(cacheKey);
        if (cached) return cached;

        // ISS doesn't have a direct API for images, using curated content
        const images = this.getISSFallback();
        this.setCache(cacheKey, images);
        return images;
      }

      // NASA Astronomy Picture of the Day
      async fetchAPOD() {
        const cacheKey = 'nasa_apod';
        const cached = this.getFromCache(cacheKey);
        if (cached) return cached;

        try {
          const response = await this.fetchWithRetry(
            'https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'
          );
          
          if (!response.ok) throw new Error(`APOD API error: ${response.status}`);
          
          const data = await response.json();
          
          if (data.media_type === 'image') {
            const image = {
              id: `apod_${data.date}`,
              title: data.title,
              description: data.explanation,
              imageUrl: data.hdurl || data.url,
              thumbnailUrl: data.url,
              source: 'nasa',
              category: 'deep-space',
              timestamp: new Date(data.date),
              sourceUrl: 'https://apod.nasa.gov/apod/',
              metadata: {
                copyright: data.copyright,
                type: 'APOD'
              }
            };
            
            this.setCache(cacheKey, [image]);
            return [image];
          }
        } catch (error) {
          console.error('APOD API error:', error);
        }
        
        return [];
      }

      // Combine and sort images from all sources
      combineAndSort(imageArrays) {
        const allImages = imageArrays.flat();
        
        // Remove duplicates based on title similarity
        const uniqueImages = this.removeDuplicates(allImages);
        
        // Sort by timestamp (newest first)
        return uniqueImages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      }

      // Remove duplicate images
      removeDuplicates(images) {
        const seen = new Set();
        return images.filter(image => {
          const key = image.title.toLowerCase().replace(/[^a-z0-9]/g, '');
          if (seen.has(key)) return false;
          seen.add(key);
          return true;
        });
      }

      // Filter images by category
      filterByCategory(images, category) {
        if (category === 'all') return images;
        return images.filter(image => image.category === category);
      }

      // Fetch with retry logic
      async fetchWithRetry(url, attempts = this.retryAttempts) {
        for (let i = 0; i < attempts; i++) {
          try {
            const response = await fetch(url);
            if (response.ok) return response;
            throw new Error(`HTTP ${response.status}`);
          } catch (error) {
            if (i === attempts - 1) throw error;
            await this.delay(this.retryDelay * Math.pow(2, i)); // Exponential backoff
          }
        }
      }

      // Utility methods
      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      getFromCache(key) {
        const cached = this.cache.get(key);
        if (cached && Date.now() - cached.timestamp < this.cacheExpiry) {
          return cached.data;
        }
        return null;
      }

      setCache(key, data) {
        this.cache.set(key, {
          data: data,
          timestamp: Date.now()
        });
      }

      getPlaceholderImage() {
        return 'https://via.placeholder.com/400x225/0033a0/ffffff?text=Space+Image';
      }

      // Fallback data when APIs are unavailable
      getFallbackImages() {
        return [
          ...this.getNASAFallback(),
          ...this.getESAFallback(),
          ...this.getSpaceXFallback(),
          ...this.getISSFallback()
        ];
      }

      getNASAFallback() {
        return [
          {
            id: 'nasa_fallback_1',
            title: 'Perseverance Mars Rover Self-Portrait',
            description: 'NASA\'s Perseverance rover took this selfie over a rock nicknamed "Rochette," on Sol 198.',
            imageUrl: 'https://images-assets.nasa.gov/image/PIA24546/PIA24546~thumb.jpg',
            thumbnailUrl: 'https://images-assets.nasa.gov/image/PIA24546/PIA24546~thumb.jpg',
            source: 'nasa',
            category: 'missions',
            timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
            sourceUrl: 'https://images.nasa.gov/',
            metadata: { mission: 'Mars 2020' }
          },
          {
            id: 'nasa_fallback_2',
            title: 'Hubble Views the Crab Nebula',
            description: 'This Hubble Space Telescope image shows the Crab Nebula, the result of a supernova explosion.',
            imageUrl: 'https://images-assets.nasa.gov/image/PIA23122/PIA23122~thumb.jpg',
            thumbnailUrl: 'https://images-assets.nasa.gov/image/PIA23122/PIA23122~thumb.jpg',
            source: 'nasa',
            category: 'deep-space',
            timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000), // 4 hours ago
            sourceUrl: 'https://images.nasa.gov/',
            metadata: { telescope: 'Hubble' }
          }
        ];
      }

      getESAFallback() {
        return [
          {
            id: 'esa_fallback_1',
            title: 'Gaia\'s View of the Milky Way',
            description: 'ESA\'s Gaia mission has created the most detailed map of our galaxy to date.',
            imageUrl: 'https://via.placeholder.com/400x225/6f42c1/ffffff?text=ESA+Gaia',
            thumbnailUrl: 'https://via.placeholder.com/400x225/6f42c1/ffffff?text=ESA+Gaia',
            source: 'esa',
            category: 'deep-space',
            timestamp: new Date(Date.now() - 6 * 60 * 60 * 1000), // 6 hours ago
            sourceUrl: 'https://www.esa.int/',
            metadata: { mission: 'Gaia' }
          }
        ];
      }

      getSpaceXFallback() {
        return [
          {
            id: 'spacex_fallback_1',
            title: 'Falcon 9 Launch',
            description: 'A SpaceX Falcon 9 rocket launches carrying crew to the International Space Station.',
            imageUrl: 'https://images-assets.nasa.gov/image/KSC-20200530-PH-SPX01_0005/KSC-20200530-PH-SPX01_0005~thumb.jpg',
            thumbnailUrl: 'https://images-assets.nasa.gov/image/KSC-20200530-PH-SPX01_0005/KSC-20200530-PH-SPX01_0005~thumb.jpg',
            source: 'spacex',
            category: 'missions',
            timestamp: new Date(Date.now() - 3 * 60 * 60 * 1000), // 3 hours ago
            sourceUrl: 'https://www.spacex.com/',
            metadata: { rocket: 'Falcon 9' }
          }
        ];
      }

      getISSFallback() {
        return [
          {
            id: 'iss_fallback_1',
            title: 'Earth from the International Space Station',
            description: 'A stunning view of Earth\'s curvature captured from the International Space Station.',
            imageUrl: 'https://images-assets.nasa.gov/image/iss066e013602/iss066e013602~thumb.jpg',
            thumbnailUrl: 'https://images-assets.nasa.gov/image/iss066e013602/iss066e013602~thumb.jpg',
            source: 'iss',
            category: 'earth',
            timestamp: new Date(Date.now() - 1 * 60 * 60 * 1000), // 1 hour ago
            sourceUrl: 'https://www.nasa.gov/mission_pages/station/',
            metadata: { location: 'ISS' }
          },
          {
            id: 'iss_fallback_2',
            title: 'Aurora from Space',
            description: 'A spectacular aurora borealis captured from the International Space Station.',
            imageUrl: 'https://images-assets.nasa.gov/image/iss066e054063/iss066e054063~thumb.jpg',
            thumbnailUrl: 'https://images-assets.nasa.gov/image/iss066e054063/iss066e054063~thumb.jpg',
            source: 'iss',
            category: 'iss',
            timestamp: new Date(Date.now() - 30 * 60 * 1000), // 30 minutes ago
            sourceUrl: 'https://www.nasa.gov/mission_pages/station/',
            metadata: { location: 'ISS', phenomenon: 'Aurora' }
          }
        ];
      }
    }

    // Initialize the data manager
    const imageDataManager = new ImageDataManager();
  </script>
  <script>
    (function initTheme(){
      const saved = localStorage.getItem("theme");
      if(saved==="dark"){document.body.classList.add("dark");document.getElementById("themeToggle").textContent="☀️";}
      document.getElementById("themeToggle").addEventListener("click",()=>{
        document.body.classList.toggle("dark");
        const isDark=document.body.classList.contains("dark");
        document.getElementById("themeToggle").textContent=isDark?"☀️":"🌙";
        localStorage.setItem("theme",isDark?"dark":"light");
      });
    })();

    (function stickyDropdowns(){
      const OPEN="open";const DELAY=160;
      document.querySelectorAll(".dropdown").forEach(dd=>{
        let t=null;const btn=dd.querySelector(".dropbtn");const menu=dd.querySelector(".dropdown-content");
        function open(){dd.classList.add(OPEN);btn?.setAttribute("aria-expanded","true");if(t){clearTimeout(t);t=null;}}
        function close(){if(t)clearTimeout(t);t=setTimeout(()=>{dd.classList.remove(OPEN);btn?.setAttribute("aria-expanded","false");},DELAY);}
        dd.addEventListener("pointerenter",open);dd.addEventListener("pointerleave",close);
        btn?.addEventListener("focus",open);
        menu?.addEventListener("focusout",e=>{if(!dd.contains(e.relatedTarget))close();});
        menu?.querySelectorAll("a").forEach(a=>{a.addEventListener("click",()=>{menu.querySelectorAll("a").forEach(el=>el.classList.remove("clicked"));a.classList.add("clicked");dd.classList.remove(OPEN);btn?.setAttribute("aria-expanded","false");});});
      });
    })();

    (function initMoonPhase(){
      function getMoonPhase(){
        const now=new Date();const m=now.getMonth()+1;const d=now.getDate();const y=now.getFullYear();
        if(y===2025&&m===8){
          if(d<=3)return 7;if(d<=6)return 0;if(d<=10)return 1;if(d<=13)return 2;if(d<=17)return 3;if(d<=20)return 4;if(d<=24)return 5;if(d<=27)return 6;return 7;
        }
        const base=new Date(2024,7,4);const days=(now-base)/(1000*60*60*24);const cycle=days/29.53;return Math.floor((cycle-Math.floor(cycle))*8)%8;
      }
      function info(p){return[{name:"New Moon",emoji:"🌑"},{name:"Waxing Crescent",emoji:"🌒"},{name:"First Quarter",emoji:"🌓"},{name:"Waxing Gibbous",emoji:"🌔"},{name:"Full Moon",emoji:"🌕"},{name:"Waning Gibbous",emoji:"🌖"},{name:"Last Quarter",emoji:"🌗"},{name:"Waning Crescent",emoji:"🌘"}][p];}
      const phase=getMoonPhase(),data=info(phase),now=new Date();
      document.getElementById("moon-display").textContent=data.emoji;
      document.querySelector(".moon-label").textContent=data.name;
      document.getElementById("moon-context").textContent=`${now.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})} • New York City, NY`;
    })();

    // Image Card Interactions
    (function initImageCards(){
      // Handle expand button clicks
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('expand-btn')) {
          const card = e.target.closest('.image-card');
          const img = card.querySelector('img');
          const title = card.querySelector('.image-title').textContent;
          
          // For now, just show an alert - will be replaced with modal in later tasks
          alert(`Opening full-size view for: ${title}`);
        }
        
        // Handle share button clicks
        if (e.target.classList.contains('share-btn')) {
          const card = e.target.closest('.image-card');
          const title = card.querySelector('.image-title').textContent;
          
          // Simple share functionality
          if (navigator.share) {
            navigator.share({
              title: title,
              text: `Check out this amazing space image: ${title}`,
              url: window.location.href
            });
          } else {
            // Fallback for browsers without Web Share API
            const url = window.location.href;
            navigator.clipboard.writeText(`${title} - ${url}`).then(() => {
              alert('Link copied to clipboard!');
            });
          }
        }
      });

      // Add keyboard navigation for accessibility
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          if (e.target.classList.contains('expand-btn') || e.target.classList.contains('share-btn')) {
            e.preventDefault();
            e.target.click();
          }
        }
      });

      // Lazy loading fallback for older browsers
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              if (img.dataset.src) {
                img.src = img.dataset.src;
                img.removeAttribute('data-src');
                observer.unobserve(img);
              }
            }
          });
        });

        document.querySelectorAll('img[data-src]').forEach(img => {
          imageObserver.observe(img);
        });
      }
    })();

    // Filter and Controls Functionality
    (function initControls(){
      const gallery = document.getElementById('image-gallery');
      const filterBtns = document.querySelectorAll('.filter-btn');
      const viewBtns = document.querySelectorAll('.view-btn');
      const refreshBtn = document.querySelector('.refresh-btn');
      const lastRefreshTime = document.getElementById('last-refresh');
      
      let currentFilter = 'all';
      let currentView = 'grid';

      // Filter functionality
      function filterImages(category) {
        const cards = gallery.querySelectorAll('.image-card');
        
        cards.forEach(card => {
          const cardCategory = card.dataset.category;
          const shouldShow = category === 'all' || cardCategory === category;
          
          if (shouldShow) {
            card.style.display = 'block';
            card.style.animation = 'fadeIn 0.3s ease-in-out';
          } else {
            card.style.display = 'none';
          }
        });

        // Update active filter button
        filterBtns.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.filter === category);
        });

        currentFilter = category;
      }

      // View switching functionality
      function switchView(view) {
        if (view === 'list') {
          gallery.classList.add('list-view');
        } else {
          gallery.classList.remove('list-view');
        }

        // Update active view button
        viewBtns.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.view === view);
        });

        currentView = view;
      }

      // Refresh functionality
      async function refreshGallery() {
        refreshBtn.classList.add('spinning');
        
        try {
          // Fetch fresh data from all sources
          const images = await imageDataManager.fetchAllImages();
          
          // Update the gallery with new images
          await updateGalleryWithImages(images);
          
          updateLastRefreshTime();
          
          // Re-apply current filter to maintain state
          filterImages(currentFilter);
          
          // Show success feedback
          const originalText = refreshBtn.title;
          refreshBtn.title = 'Refreshed!';
          setTimeout(() => {
            refreshBtn.title = originalText;
          }, 2000);
          
        } catch (error) {
          console.error('Refresh failed:', error);
          
          // Show error feedback
          const originalText = refreshBtn.title;
          refreshBtn.title = 'Refresh failed - try again';
          setTimeout(() => {
            refreshBtn.title = originalText;
          }, 3000);
        } finally {
          refreshBtn.classList.remove('spinning');
        }
      }

      // Update gallery with new image data
      async function updateGalleryWithImages(images) {
        // Clear existing content
        gallery.innerHTML = '';
        
        // Add loading indicator
        gallery.innerHTML = '<div class="loading-message">Loading fresh space imagery...</div>';
        
        // Simulate loading delay for better UX
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // Clear loading message
        gallery.innerHTML = '';
        
        // Create image cards from data
        images.forEach(imageData => {
          const card = createImageCard(imageData);
          gallery.appendChild(card);
        });
        
        // Reinitialize lazy loading for new images
        initializeLazyLoading();
      }

      // Create an image card element from data
      function createImageCard(imageData) {
        const card = document.createElement('article');
        card.className = 'image-card';
        card.dataset.category = imageData.category;
        card.dataset.source = imageData.source;
        
        const timeAgo = getTimeAgo(imageData.timestamp);
        
        card.innerHTML = `
          <div class="image-container">
            <img src="${imageData.thumbnailUrl}" 
                 alt="${imageData.title}" 
                 loading="lazy">
            <div class="image-overlay">
              <button class="overlay-btn expand-btn" title="View Full Size">🔍</button>
              <button class="overlay-btn share-btn" title="Share Image">📤</button>
            </div>
          </div>
          <div class="image-info">
            <h3 class="image-title">${imageData.title}</h3>
            <p class="image-description">${imageData.description}</p>
            <div class="image-meta">
              <span class="source">${imageData.source.toUpperCase()}</span>
              <time class="timestamp">${timeAgo}</time>
            </div>
          </div>
        `;
        
        return card;
      }

      // Calculate time ago string
      function getTimeAgo(timestamp) {
        const now = new Date();
        const diff = now - new Date(timestamp);
        const minutes = Math.floor(diff / (1000 * 60));
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        
        if (minutes < 60) {
          return minutes <= 1 ? 'just now' : `${minutes} minutes ago`;
        } else if (hours < 24) {
          return hours === 1 ? '1 hour ago' : `${hours} hours ago`;
        } else {
          return days === 1 ? '1 day ago' : `${days} days ago`;
        }
      }

      // Initialize lazy loading for new images
      function initializeLazyLoading() {
        if ('IntersectionObserver' in window) {
          const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                  img.src = img.dataset.src;
                  img.removeAttribute('data-src');
                  observer.unobserve(img);
                }
              }
            });
          });

          document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
          });
        }
      }

      // Update last refresh time
      function updateLastRefreshTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', { 
          hour: 'numeric', 
          minute: '2-digit',
          hour12: true 
        });
        lastRefreshTime.textContent = timeString;
      }

      // Event listeners
      filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          filterImages(btn.dataset.filter);
        });
      });

      viewBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          switchView(btn.dataset.view);
        });
      });

      refreshBtn.addEventListener('click', refreshGallery);

      // Keyboard navigation for controls
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          if (e.target.classList.contains('filter-btn') || 
              e.target.classList.contains('view-btn') || 
              e.target.classList.contains('refresh-btn')) {
            e.preventDefault();
            e.target.click();
          }
        }
      });

      // Initialize
      updateLastRefreshTime();
      
      // Load initial data
      async function initializeGallery() {
        try {
          // Show loading state
          gallery.innerHTML = '<div class="loading-message">Loading space imagery from NASA, ESA, SpaceX, and ISS...</div>';
          
          // Fetch initial data
          const images = await imageDataManager.fetchAllImages();
          
          if (images.length > 0) {
            await updateGalleryWithImages(images);
          } else {
            // Show error if no images loaded
            gallery.innerHTML = '<div class="error-message">Unable to load images. Please check your connection and try refreshing.</div>';
          }
        } catch (error) {
          console.error('Failed to initialize gallery:', error);
          gallery.innerHTML = '<div class="error-message">Failed to load images. Please try refreshing the page.</div>';
        }
      }
      
      // Start initialization
      initializeGallery();
      
      // Auto-refresh every 5 minutes
      setInterval(() => {
        if (document.visibilityState === 'visible') {
          refreshGallery();
        }
      }, 300000); // 5 minutes
    })();
  </script>
</body>
</html>