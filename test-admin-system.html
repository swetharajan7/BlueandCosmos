<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExploreX Admin Dashboard Test</title>
    <link rel="stylesheet" href="explorex-admin-styles.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            min-height: 100vh;
            padding-top: 80px; /* Account for admin toolbar */
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .test-header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .login-section {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .login-form {
            display: inline-block;
            text-align: left;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.4);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .btn.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .test-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .control-group h3 {
            margin-top: 0;
            color: #495057;
        }

        .status-display {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-value {
            font-weight: bold;
            color: #1e293b;
        }

        .demo-accounts {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .demo-accounts h4 {
            margin: 0 0 10px 0;
            color: #92400e;
        }

        .demo-account {
            margin: 8px 0;
            font-size: 0.9rem;
            color: #78350f;
        }

        .log-container {
            background: #1e293b;
            color: #10b981;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .admin-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .admin-status.active {
            background: #dcfce7;
            color: #166534;
        }

        .admin-status.inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #64748b;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üëë ExploreX Admin Dashboard Test</h1>
            <p>Comprehensive admin interface testing for content management, user administration, and system monitoring</p>
        </div>

        <div class="login-section" id="login-section">
            <h2>Admin Authentication</h2>
            <p>Login with admin credentials to access the dashboard</p>
            
            <div class="login-form">
                <div class="form-group">
                    <label for="admin-username">Username:</label>
                    <input type="email" id="admin-username" placeholder="Enter admin email">
                </div>
                
                <div class="form-group">
                    <label for="admin-password">Password:</label>
                    <input type="password" id="admin-password" placeholder="Enter password">
                </div>
                
                <button class="btn" onclick="adminLogin()">üîê Login as Admin</button>
                
                <div class="demo-accounts">
                    <h4>üìã Demo Accounts:</h4>
                    <div class="demo-account"><strong>Admin:</strong> admin@explorex.com / admin123</div>
                    <div class="demo-account"><strong>Moderator:</strong> moderator@explorex.com / mod123</div>
                    <div class="demo-account"><strong>Analyst:</strong> analyst@explorex.com / analyst123</div>
                </div>
            </div>
        </div>

        <div class="status-display">
            <h3>Admin System Status</h3>
            <div class="status-item">
                <span>Admin Mode:</span>
                <span class="admin-status inactive" id="admin-mode-status">Inactive</span>
            </div>
            <div class="status-item">
                <span>Current Admin:</span>
                <span class="status-value" id="current-admin">None</span>
            </div>
            <div class="status-item">
                <span>Admin Role:</span>
                <span class="status-value" id="admin-role">-</span>
            </div>
            <div class="status-item">
                <span>Permissions:</span>
                <span class="status-value" id="admin-permissions">-</span>
            </div>
            <div class="status-item">
                <span>Session Duration:</span>
                <span class="status-value" id="session-duration">-</span>
            </div>
        </div>

        <div class="test-controls">
            <div class="control-group">
                <h3>üìä Dashboard Management</h3>
                <button class="btn secondary" onclick="testShowDashboard()">Show Admin Dashboard</button>
                <button class="btn secondary" onclick="testAnalyticsExport()">Export Analytics</button>
                <button class="btn secondary" onclick="testGenerateReport()">Generate Report</button>
                <button class="btn secondary" onclick="testSystemHealth()">Check System Health</button>
            </div>

            <div class="control-group">
                <h3>üìù Content Management</h3>
                <button class="btn" onclick="testShowContentManager()">Show Content Manager</button>
                <button class="btn" onclick="testCreatePendingContent()">Create Pending Content</button>
                <button class="btn success" onclick="testApproveContent()">Approve Content</button>
                <button class="btn warning" onclick="testRejectContent()">Reject Content</button>
            </div>

            <div class="control-group">
                <h3>üë• User Management</h3>
                <button class="btn" onclick="testShowUserManager()">Show User Manager</button>
                <button class="btn" onclick="testCreateTestUsers()">Create Test Users</button>
                <button class="btn warning" onclick="testSuspendUser()">Suspend User</button>
                <button class="btn" onclick="testUserActivity()">View User Activity</button>
            </div>

            <div class="control-group">
                <h3>üîß System Monitoring</h3>
                <button class="btn" onclick="testShowSystemMonitor()">Show System Monitor</button>
                <button class="btn warning" onclick="testCreateAlert()">Create Test Alert</button>
                <button class="btn" onclick="testAcknowledgeAlerts()">Acknowledge Alerts</button>
                <button class="btn" onclick="testAuditLog()">View Audit Log</button>
            </div>

            <div class="control-group">
                <h3>üîë Admin Actions</h3>
                <button class="btn" onclick="testPermissionCheck()">Test Permissions</button>
                <button class="btn" onclick="testAdminKeyboardShortcuts()">Test Keyboard Shortcuts</button>
                <button class="btn warning" onclick="testAccessDenied()">Test Access Denied</button>
                <button class="btn" onclick="adminLogout()">üö™ Admin Logout</button>
            </div>

            <div class="control-group">
                <h3>üìà Real-time Monitoring</h3>
                <button class="btn secondary" onclick="startRealTimeUpdates()">Start Real-time Updates</button>
                <button class="btn secondary" onclick="stopRealTimeUpdates()">Stop Updates</button>
                <button class="btn secondary" onclick="simulateSystemLoad()">Simulate System Load</button>
                <button class="btn secondary" onclick="testAlertThresholds()">Test Alert Thresholds</button>
            </div>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="total-users">0</div>
                <div class="metric-label">Total Users</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value" id="pending-content">0</div>
                <div class="metric-label">Pending Content</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value" id="system-alerts">0</div>
                <div class="metric-label">System Alerts</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value" id="admin-actions">0</div>
                <div class="metric-label">Admin Actions</div>
            </div>
        </div>

        <div class="log-container" id="log-container">
            <div>üëë ExploreX Admin Dashboard Test Console</div>
            <div>Ready for admin testing...</div>
        </div>
    </div>

    <!-- Load Admin System -->
    <script src="explorex-admin-system.js"></script>

    <script>
        // Global variables
        let adminManager;
        let realTimeInterval;
        let sessionStartTime;
        let adminMetrics = {
            totalUsers: 0,
            pendingContent: 0,
            systemAlerts: 0,
            adminActions: 0
        };

        // Initialize admin system
        async function initializeAdminSystem() {
            try {
                log('üöÄ Initializing Admin Dashboard System...');

                // Get the global admin manager
                adminManager = window.ExploreXAdmin;
                await adminManager.initialize();

                // Setup test data
                setupTestData();

                // Update UI
                updateAdminStatus();

                log('‚úÖ Admin Dashboard System initialized successfully');

            } catch (error) {
                log(`‚ùå Admin system initialization failed: ${error.message}`);
                console.error('Admin initialization error:', error);
            }
        }

        // Setup test data
        function setupTestData() {
            // Create some test users
            const testUsers = [
                {
                    id: 'user_1',
                    name: 'John Doe',
                    email: 'john@example.com',
                    role: 'user',
                    status: 'active',
                    createdAt: Date.now() - 30 * 24 * 60 * 60 * 1000
                },
                {
                    id: 'user_2',
                    name: 'Jane Smith',
                    email: 'jane@example.com',
                    role: 'user',
                    status: 'active',
                    createdAt: Date.now() - 15 * 24 * 60 * 60 * 1000
                },
                {
                    id: 'user_3',
                    name: 'Bob Wilson',
                    email: 'bob@example.com',
                    role: 'user',
                    status: 'suspended',
                    createdAt: Date.now() - 60 * 24 * 60 * 60 * 1000
                }
            ];

            localStorage.setItem('explorex-users', JSON.stringify(testUsers));

            // Create some pending content
            adminManager.contentQueue = [
                {
                    id: 'content_1',
                    type: 'review',
                    title: 'Amazing Observatory Experience',
                    authorName: 'John Doe',
                    submittedAt: Date.now() - 2 * 60 * 60 * 1000,
                    status: 'pending'
                },
                {
                    id: 'content_2',
                    type: 'photo',
                    title: 'Telescope Photo',
                    authorName: 'Jane Smith',
                    submittedAt: Date.now() - 4 * 60 * 60 * 1000,
                    status: 'pending'
                }
            ];

            adminMetrics.totalUsers = testUsers.length;
            adminMetrics.pendingContent = adminManager.contentQueue.filter(c => c.status === 'pending').length;
            
            updateMetrics();
        }

        // Admin login
        async function adminLogin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;

            if (!username || !password) {
                log('‚ö†Ô∏è Please enter username and password');
                return;
            }

            try {
                log(`üîê Attempting admin login for: ${username}`);
                
                const result = await adminManager.adminLogin({ username, password });
                
                if (result.success) {
                    sessionStartTime = Date.now();
                    document.getElementById('login-section').style.display = 'none';
                    updateAdminStatus();
                    log(`‚úÖ Admin login successful: ${result.admin.name} (${result.admin.role})`);
                } else {
                    log('‚ùå Admin login failed: Invalid credentials');
                }

            } catch (error) {
                log(`‚ùå Admin login failed: ${error.message}`);
            }
        }

        // Admin logout
        function adminLogout() {
            adminManager.adminLogout();
            sessionStartTime = null;
            document.getElementById('login-section').style.display = 'block';
            updateAdminStatus();
            log('üö™ Admin logged out successfully');
        }

        // Dashboard management functions
        function testShowDashboard() {
            adminManager.showDashboard();
            log('üìä Admin dashboard opened');
        }

        function testAnalyticsExport() {
            adminManager.exportAnalytics();
            log('üì• Analytics export initiated');
        }

        function testGenerateReport() {
            adminManager.generateReport();
            log('üìã Report generation initiated');
        }

        function testSystemHealth() {
            const health = adminManager.systemMonitor.checkSystemHealth();
            log(`üîß System health: ${health.status} (${health.alerts.length} alerts)`);
        }

        // Content management functions
        function testShowContentManager() {
            adminManager.showContentManager();
            log('üìù Content manager opened');
        }

        function testCreatePendingContent() {
            const newContent = {
                id: 'content_' + Date.now(),
                type: 'review',
                title: 'Test Review Content',
                authorName: 'Test User',
                submittedAt: Date.now(),
                status: 'pending'
            };

            adminManager.contentQueue.push(newContent);
            adminMetrics.pendingContent++;
            updateMetrics();
            log('üìù New pending content created');
        }

        function testApproveContent() {
            const pendingContent = adminManager.contentQueue.find(c => c.status === 'pending');
            if (pendingContent) {
                adminManager.approveContent(pendingContent.id);
                adminMetrics.pendingContent--;
                adminMetrics.adminActions++;
                updateMetrics();
                log(`‚úÖ Content approved: ${pendingContent.id}`);
            } else {
                log('‚ö†Ô∏è No pending content to approve');
            }
        }

        function testRejectContent() {
            const pendingContent = adminManager.contentQueue.find(c => c.status === 'pending');
            if (pendingContent) {
                adminManager.rejectContent(pendingContent.id, 'Test rejection');
                adminMetrics.pendingContent--;
                adminMetrics.adminActions++;
                updateMetrics();
                log(`‚ùå Content rejected: ${pendingContent.id}`);
            } else {
                log('‚ö†Ô∏è No pending content to reject');
            }
        }

        // User management functions
        function testShowUserManager() {
            adminManager.showUserManager();
            log('üë• User manager opened');
        }

        function testCreateTestUsers() {
            const newUser = {
                id: 'user_' + Date.now(),
                name: 'Test User ' + Math.floor(Math.random() * 1000),
                email: `testuser${Date.now()}@example.com`,
                role: 'user',
                status: 'active',
                createdAt: Date.now()
            };

            const users = JSON.parse(localStorage.getItem('explorex-users') || '[]');
            users.push(newUser);
            localStorage.setItem('explorex-users', JSON.stringify(users));
            
            adminMetrics.totalUsers++;
            updateMetrics();
            log(`üë§ Test user created: ${newUser.name}`);
        }

        function testSuspendUser() {
            const users = JSON.parse(localStorage.getItem('explorex-users') || '[]');
            const activeUser = users.find(u => u.status === 'active');
            
            if (activeUser) {
                adminManager.userManager.suspendUser(activeUser.id, 'Test suspension', 7 * 24 * 60 * 60 * 1000);
                adminMetrics.adminActions++;
                updateMetrics();
                log(`‚è∏Ô∏è User suspended: ${activeUser.name}`);
            } else {
                log('‚ö†Ô∏è No active users to suspend');
            }
        }

        function testUserActivity() {
            const users = JSON.parse(localStorage.getItem('explorex-users') || '[]');
            if (users.length > 0) {
                const activity = adminManager.userManager.getUserActivity(users[0].id);
                log(`üìä User activity retrieved: ${activity.length} entries`);
            } else {
                log('‚ö†Ô∏è No users available for activity check');
            }
        }

        // System monitoring functions
        function testShowSystemMonitor() {
            adminManager.showSystemMonitor();
            log('üîß System monitor opened');
        }

        function testCreateAlert() {
            const alert = adminManager.systemMonitor.createAlert(
                'test_alert',
                'medium',
                'This is a test alert for demonstration purposes',
                { testData: true }
            );
            
            adminMetrics.systemAlerts++;
            updateMetrics();
            log(`üö® Test alert created: ${alert.id}`);
        }

        function testAcknowledgeAlerts() {
            const unacknowledgedAlerts = adminManager.systemAlerts.filter(a => !a.acknowledged);
            
            if (unacknowledgedAlerts.length > 0) {
                adminManager.systemMonitor.acknowledgeAlert(unacknowledgedAlerts[0].id);
                adminMetrics.adminActions++;
                updateMetrics();
                log(`‚úÖ Alert acknowledged: ${unacknowledgedAlerts[0].id}`);
            } else {
                log('‚ö†Ô∏è No unacknowledged alerts');
            }
        }

        function testAuditLog() {
            const logEntries = adminManager.auditLog.slice(-10);
            log(`üìã Audit log: ${logEntries.length} recent entries`);
            console.log('Audit log entries:', logEntries);
        }

        // Admin action functions
        function testPermissionCheck() {
            const permissions = ['viewAnalytics', 'moderateContent', 'manageUsers', 'systemConfig'];
            
            permissions.forEach(permission => {
                const hasPermission = adminManager.hasPermission(permission);
                log(`üîë Permission '${permission}': ${hasPermission ? '‚úÖ Granted' : '‚ùå Denied'}`);
            });
        }

        function testAdminKeyboardShortcuts() {
            log('‚å®Ô∏è Testing keyboard shortcuts:');
            log('   Ctrl+Alt+D - Dashboard');
            log('   Ctrl+Alt+C - Content Manager');
            log('   Ctrl+Alt+U - User Manager');
            log('   Ctrl+Alt+S - System Monitor');
        }

        function testAccessDenied() {
            adminManager.showAccessDenied();
            log('üö´ Access denied dialog shown');
        }

        // Real-time monitoring functions
        function startRealTimeUpdates() {
            if (realTimeInterval) {
                clearInterval(realTimeInterval);
            }

            realTimeInterval = setInterval(() => {
                // Simulate system metrics updates
                const health = adminManager.systemMonitor.checkSystemHealth();
                
                // Randomly create alerts
                if (Math.random() < 0.1) { // 10% chance
                    testCreateAlert();
                }
                
                updateAdminStatus();
                log('üîÑ Real-time update performed');
            }, 5000);

            log('üîÑ Real-time monitoring started');
        }

        function stopRealTimeUpdates() {
            if (realTimeInterval) {
                clearInterval(realTimeInterval);
                realTimeInterval = null;
                log('‚èπÔ∏è Real-time monitoring stopped');
            }
        }

        function simulateSystemLoad() {
            // Simulate high system load
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    adminManager.systemMonitor.createAlert(
                        'high_load',
                        'high',
                        `System load spike detected: ${Math.floor(Math.random() * 40 + 60)}%`,
                        { load: Math.random() * 40 + 60 }
                    );
                    adminMetrics.systemAlerts++;
                    updateMetrics();
                }, i * 1000);
            }
            
            log('üìà System load simulation started');
        }

        function testAlertThresholds() {
            const thresholds = adminManager.config.monitoring.alertThresholds;
            
            log('üéØ Alert thresholds:');
            Object.entries(thresholds).forEach(([metric, threshold]) => {
                log(`   ${metric}: ${threshold}`);
            });
        }

        // UI update functions
        function updateAdminStatus() {
            const isActive = adminManager.config.enableAdminMode;
            const statusElement = document.getElementById('admin-mode-status');
            
            statusElement.textContent = isActive ? 'Active' : 'Inactive';
            statusElement.className = `admin-status ${isActive ? 'active' : 'inactive'}`;
            
            if (adminManager.currentAdmin) {
                document.getElementById('current-admin').textContent = adminManager.currentAdmin.name;
                document.getElementById('admin-role').textContent = adminManager.currentAdmin.role;
                document.getElementById('admin-permissions').textContent = 
                    adminManager.currentAdmin.permissions?.join(', ') || 'Limited';
                
                if (sessionStartTime) {
                    const duration = Math.floor((Date.now() - sessionStartTime) / 1000);
                    const minutes = Math.floor(duration / 60);
                    const seconds = duration % 60;
                    document.getElementById('session-duration').textContent = `${minutes}m ${seconds}s`;
                }
            } else {
                document.getElementById('current-admin').textContent = 'None';
                document.getElementById('admin-role').textContent = '-';
                document.getElementById('admin-permissions').textContent = '-';
                document.getElementById('session-duration').textContent = '-';
            }
        }

        function updateMetrics() {
            document.getElementById('total-users').textContent = adminMetrics.totalUsers;
            document.getElementById('pending-content').textContent = adminMetrics.pendingContent;
            document.getElementById('system-alerts').textContent = adminMetrics.systemAlerts;
            document.getElementById('admin-actions').textContent = adminMetrics.adminActions;
        }

        function log(message) {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeAdminSystem();
            
            // Update session duration every second
            setInterval(() => {
                if (sessionStartTime) {
                    updateAdminStatus();
                }
            }, 1000);
        });

        // Auto-fill demo credentials for testing
        setTimeout(() => {
            document.getElementById('admin-username').value = 'admin@explorex.com';
            document.getElementById('admin-password').value = 'admin123';
        }, 1000);
    </script>
</body>
</html>