<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExploreX Security System Test</title>
    <link rel="stylesheet" href="explorex-security-styles.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .test-header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .test-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .control-group h3 {
            margin-top: 0;
            color: #495057;
        }

        .btn {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 58, 138, 0.4);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .status-display {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-value {
            font-weight: bold;
            color: #495057;
        }

        .test-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .security-dashboard-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .log-container {
            background: #212529;
            color: #28a745;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .metric-card h4 {
            margin-top: 0;
            color: #495057;
        }

        .security-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .security-good { background-color: #10b981; }
        .security-warning { background-color: #f59e0b; }
        .security-danger { background-color: #ef4444; }
    </style>
</head>
<body>
    <div class="security-dashboard-toggle">
        <button class="btn" onclick="toggleSecurityDashboard()">
            üîí Security Dashboard
        </button>
    </div>

    <div class="test-container">
        <div class="test-header">
            <h1>üîí ExploreX Security & Data Protection Test</h1>
            <p>Comprehensive testing of security measures, input validation, GDPR compliance, and data protection</p>
        </div>

        <div class="status-display">
            <h3>Security System Status</h3>
            <div class="status-item">
                <span>Security Manager:</span>
                <span class="status-value" id="security-status">Initializing...</span>
            </div>
            <div class="status-item">
                <span>Input Validation:</span>
                <span class="status-value" id="validation-status">Initializing...</span>
            </div>
            <div class="status-item">
                <span>Rate Limiting:</span>
                <span class="status-value" id="ratelimit-status">Initializing...</span>
            </div>
            <div class="status-item">
                <span>GDPR Compliance:</span>
                <span class="status-value" id="gdpr-status">Initializing...</span>
            </div>
            <div class="status-item">
                <span>Security Events:</span>
                <span class="status-value" id="events-count">0</span>
            </div>
        </div>

        <div class="test-controls">
            <div class="control-group">
                <h3>üõ°Ô∏è Input Validation Testing</h3>
                <button class="btn" onclick="testEmailValidation()">Test Email Validation</button>
                <button class="btn" onclick="testPasswordValidation()">Test Password Validation</button>
                <button class="btn" onclick="testXSSPrevention()">Test XSS Prevention</button>
                <button class="btn" onclick="testFormValidation()">Test Form Validation</button>
            </div>

            <div class="control-group">
                <h3>üö¶ Rate Limiting Testing</h3>
                <button class="btn" onclick="testSearchRateLimit()">Test Search Rate Limit</button>
                <button class="btn" onclick="testAPIRateLimit()">Test API Rate Limit</button>
                <button class="btn" onclick="testLoginRateLimit()">Test Login Rate Limit</button>
                <button class="btn warning" onclick="triggerRateLimitViolation()">Trigger Rate Limit</button>
            </div>

            <div class="control-group">
                <h3>üîê Session Security Testing</h3>
                <button class="btn" onclick="createSecureSession()">Create Secure Session</button>
                <button class="btn" onclick="testSessionTimeout()">Test Session Timeout</button>
                <button class="btn" onclick="testSessionFingerprint()">Test Session Fingerprint</button>
                <button class="btn danger" onclick="invalidateSession()">Invalidate Session</button>
            </div>

            <div class="control-group">
                <h3>üá™üá∫ GDPR Compliance Testing</h3>
                <button class="btn" onclick="showGDPRBanner()">Show GDPR Banner</button>
                <button class="btn" onclick="testDataExport()">Test Data Export</button>
                <button class="btn" onclick="testDataDeletion()">Test Data Deletion</button>
                <button class="btn secondary" onclick="showPrivacySettings()">Privacy Settings</button>
            </div>

            <div class="control-group">
                <h3>üîë API Security Testing</h3>
                <button class="btn" onclick="testAPIKeyRotation()">Test API Key Rotation</button>
                <button class="btn" onclick="testSecureStorage()">Test Secure Storage</button>
                <button class="btn" onclick="testCSRFProtection()">Test CSRF Protection</button>
                <button class="btn warning" onclick="simulateSecurityBreach()">Simulate Security Breach</button>
            </div>

            <div class="control-group">
                <h3>üìä Security Monitoring</h3>
                <button class="btn" onclick="generateSecurityReport()">Generate Security Report</button>
                <button class="btn" onclick="exportSecurityLogs()">Export Security Logs</button>
                <button class="btn" onclick="clearSecurityEvents()">Clear Security Events</button>
                <button class="btn secondary" onclick="showSecurityMetrics()">Show Security Metrics</button>
            </div>
        </div>

        <!-- Test Forms -->
        <div class="test-form">
            <h3>üß™ Input Validation Test Form</h3>
            <form id="validation-test-form">
                <div class="form-group">
                    <label for="test-email">Email Address:</label>
                    <input type="email" id="test-email" name="email" required 
                           placeholder="Enter your email address">
                </div>
                
                <div class="form-group">
                    <label for="test-password">Password:</label>
                    <input type="password" id="test-password" name="password" required 
                           placeholder="Enter a secure password">
                </div>
                
                <div class="form-group">
                    <label for="test-name">Full Name:</label>
                    <input type="text" id="test-name" name="name" required 
                           data-validation-type="name" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label for="test-phone">Phone Number:</label>
                    <input type="tel" id="test-phone" name="phone" 
                           placeholder="Enter your phone number">
                </div>
                
                <div class="form-group">
                    <label for="test-message">Message (XSS Test):</label>
                    <textarea id="test-message" name="message" rows="4" 
                              placeholder="Try entering some HTML or JavaScript..."></textarea>
                </div>
                
                <button type="submit" class="btn">Submit Test Form</button>
            </form>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <h4>üîí Security Metrics</h4>
                <div id="security-metrics">
                    <div class="status-item">
                        <span>Active Sessions:</span>
                        <span class="status-value" id="active-sessions">0</span>
                    </div>
                    <div class="status-item">
                        <span>Rate Limit Violations:</span>
                        <span class="status-value" id="rate-violations">0</span>
                    </div>
                    <div class="status-item">
                        <span>XSS Attempts Blocked:</span>
                        <span class="status-value" id="xss-blocked">0</span>
                    </div>
                    <div class="status-item">
                        <span>Validation Failures:</span>
                        <span class="status-value" id="validation-failures">0</span>
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h4>üõ°Ô∏è Protection Status</h4>
                <div id="protection-status">
                    <div class="status-item">
                        <span>XSS Protection:</span>
                        <span class="status-value" id="xss-protection">Active</span>
                        <span class="security-indicator security-good"></span>
                    </div>
                    <div class="status-item">
                        <span>CSRF Protection:</span>
                        <span class="status-value" id="csrf-protection">Active</span>
                        <span class="security-indicator security-good"></span>
                    </div>
                    <div class="status-item">
                        <span>SSL/TLS:</span>
                        <span class="status-value" id="ssl-status">Secure</span>
                        <span class="security-indicator security-good"></span>
                    </div>
                    <div class="status-item">
                        <span>Session Security:</span>
                        <span class="status-value" id="session-security">Active</span>
                        <span class="security-indicator security-good"></span>
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h4>üìã GDPR Compliance</h4>
                <div id="gdpr-metrics">
                    <div class="status-item">
                        <span>Consent Status:</span>
                        <span class="status-value" id="consent-status">Pending</span>
                    </div>
                    <div class="status-item">
                        <span>Data Retention:</span>
                        <span class="status-value" id="data-retention">30 days</span>
                    </div>
                    <div class="status-item">
                        <span>Privacy Controls:</span>
                        <span class="status-value" id="privacy-controls">Available</span>
                    </div>
                    <div class="status-item">
                        <span>Data Export:</span>
                        <span class="status-value" id="data-export">Ready</span>
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h4>‚ö†Ô∏è Security Alerts</h4>
                <div id="security-alerts">
                    <div class="status-item">
                        <span>Critical Alerts:</span>
                        <span class="status-value" id="critical-alerts">0</span>
                    </div>
                    <div class="status-item">
                        <span>Warning Alerts:</span>
                        <span class="status-value" id="warning-alerts">0</span>
                    </div>
                    <div class="status-item">
                        <span>Info Alerts:</span>
                        <span class="status-value" id="info-alerts">0</span>
                    </div>
                    <div class="status-item">
                        <span>Last Alert:</span>
                        <span class="status-value" id="last-alert">None</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="log-container" id="log-container">
            <div>üîí Security System Test Console</div>
            <div>Ready for security testing...</div>
        </div>
    </div>

    <!-- Load Security System -->
    <script src="explorex-security-system.js"></script>

    <script>
        // Global variables
        let securityManager;
        let securityMetrics = {
            activeSessions: 0,
            rateViolations: 0,
            xssBlocked: 0,
            validationFailures: 0,
            securityEvents: 0
        };

        // Initialize security system
        async function initializeSecuritySystem() {
            try {
                log('üöÄ Initializing Security System...');

                // Initialize Security Manager
                securityManager = new window.ExploreXSecurity.SecurityManager();
                await securityManager.initialize();
                updateStatus('security-status', '‚úÖ Active');
                updateStatus('validation-status', '‚úÖ Active');
                updateStatus('ratelimit-status', '‚úÖ Active');
                updateStatus('gdpr-status', '‚úÖ Active');
                log('‚úÖ Security System initialized successfully');

                // Start monitoring
                startSecurityMonitoring();

                // Make security manager globally available for testing
                window.ExploreXSecurityDebug = {
                    manager: securityManager,
                    showDashboard: () => showSecurityDashboard(),
                    getReport: () => securityManager.getSecurityDashboard(),
                    metrics: securityMetrics
                };

            } catch (error) {
                log(`‚ùå Security initialization failed: ${error.message}`);
                console.error('Security initialization error:', error);
            }
        }

        // Input validation testing functions
        function testEmailValidation() {
            const testEmails = [
                'valid@example.com',
                'invalid-email',
                'test@',
                '@example.com',
                'test@example',
                'user+tag@example.com'
            ];

            testEmails.forEach(email => {
                const input = document.getElementById('test-email');
                input.value = email;
                const isValid = securityManager.validateInput(input);
                log(`üìß Email validation: "${email}" - ${isValid ? '‚úÖ Valid' : '‚ùå Invalid'}`);
            });
        }

        function testPasswordValidation() {
            const testPasswords = [
                'Password123!',
                'weak',
                'NoNumbers!',
                'nonumbers123!',
                'NOLOWERCASE123!',
                'NoSpecialChars123'
            ];

            testPasswords.forEach(password => {
                const input = document.getElementById('test-password');
                input.value = password;
                const isValid = securityManager.validateInput(input);
                log(`üîê Password validation: "${password}" - ${isValid ? '‚úÖ Valid' : '‚ùå Invalid'}`);
            });
        }

        function testXSSPrevention() {
            const xssAttempts = [
                '<script>alert("XSS")</script>',
                'javascript:alert("XSS")',
                '<img src="x" onerror="alert(\'XSS\')">',
                '<svg onload="alert(\'XSS\')">',
                'onclick="alert(\'XSS\')"'
            ];

            xssAttempts.forEach(attempt => {
                const sanitized = securityManager.sanitizeInput(attempt);
                const blocked = sanitized !== attempt;
                if (blocked) {
                    securityMetrics.xssBlocked++;
                    updateSecurityMetrics();
                }
                log(`üõ°Ô∏è XSS test: "${attempt}" - ${blocked ? 'üö´ Blocked' : '‚ö†Ô∏è Passed'}`);
            });
        }

        function testFormValidation() {
            const form = document.getElementById('validation-test-form');
            const isValid = securityManager.validateForm(form);
            log(`üìã Form validation: ${isValid ? '‚úÖ Valid' : '‚ùå Invalid'}`);
            
            if (!isValid) {
                securityMetrics.validationFailures++;
                updateSecurityMetrics();
            }
        }

        // Rate limiting testing functions
        function testSearchRateLimit() {
            for (let i = 0; i < 35; i++) {
                const allowed = securityManager.checkRateLimit('search');
                if (!allowed) {
                    securityMetrics.rateViolations++;
                    updateSecurityMetrics();
                    log(`üö¶ Search rate limit exceeded at request ${i + 1}`);
                    break;
                }
            }
            log('üîç Search rate limit test completed');
        }

        function testAPIRateLimit() {
            for (let i = 0; i < 105; i++) {
                const allowed = securityManager.checkRateLimit('api', 'test-endpoint');
                if (!allowed) {
                    securityMetrics.rateViolations++;
                    updateSecurityMetrics();
                    log(`üö¶ API rate limit exceeded at request ${i + 1}`);
                    break;
                }
            }
            log('üåê API rate limit test completed');
        }

        function testLoginRateLimit() {
            for (let i = 0; i < 7; i++) {
                const allowed = securityManager.checkRateLimit('login');
                if (!allowed) {
                    securityMetrics.rateViolations++;
                    updateSecurityMetrics();
                    log(`üö¶ Login rate limit exceeded at attempt ${i + 1}`);
                    break;
                }
            }
            log('üîê Login rate limit test completed');
        }

        function triggerRateLimitViolation() {
            securityManager.showRateLimitError('search');
            securityMetrics.rateViolations++;
            updateSecurityMetrics();
            log('üö® Rate limit violation triggered');
        }

        // Session security testing functions
        function createSecureSession() {
            const token = securityManager.generateSessionToken();
            securityMetrics.activeSessions++;
            updateSecurityMetrics();
            log(`üîê Secure session created: ${token.substring(0, 8)}...`);
        }

        function testSessionTimeout() {
            securityManager.checkSessionTimeout();
            log('‚è∞ Session timeout check performed');
        }

        function testSessionFingerprint() {
            const fingerprint = securityManager.generateFingerprint();
            log(`üë§ Browser fingerprint generated: ${fingerprint.substring(0, 20)}...`);
        }

        function invalidateSession() {
            const token = securityManager.getCurrentSessionToken();
            if (token) {
                securityManager.invalidateSession(token, 'manual');
                securityMetrics.activeSessions = Math.max(0, securityMetrics.activeSessions - 1);
                updateSecurityMetrics();
                log('üö´ Session invalidated');
            } else {
                log('‚ö†Ô∏è No active session to invalidate');
            }
        }

        // GDPR compliance testing functions
        function showGDPRBanner() {
            // Remove existing consent to trigger banner
            localStorage.removeItem('explorex-gdpr-consent');
            securityManager.checkGDPRConsent();
            log('üá™üá∫ GDPR consent banner displayed');
        }

        function testDataExport() {
            const data = {
                userProfile: { name: 'Test User', email: 'test@example.com' },
                preferences: { theme: 'dark', notifications: true },
                searchHistory: ['observatory', 'planetarium'],
                savedExperiences: ['exp1', 'exp2']
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `user-data-export-${Date.now()}.json`;
            a.click();
            
            log('üì• User data export completed');
        }

        function testDataDeletion() {
            // Simulate data deletion
            const keysToDelete = [
                'user-preferences',
                'search-history',
                'saved-experiences',
                'analytics-data'
            ];
            
            keysToDelete.forEach(key => {
                localStorage.removeItem(key);
            });
            
            log('üóëÔ∏è User data deletion completed');
        }

        function showPrivacySettings() {
            // Create privacy settings modal
            const modal = document.createElement('div');
            modal.className = 'privacy-settings-modal';
            modal.innerHTML = `
                <div class="privacy-settings-content">
                    <div class="privacy-settings-header">
                        <h2>üîí Privacy Settings</h2>
                        <p>Control how your data is collected and used</p>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-toggle active" onclick="togglePrivacyOption(this)"></div>
                        <div class="privacy-option-info">
                            <h4>Essential Cookies</h4>
                            <p>Required for basic site functionality. Cannot be disabled.</p>
                        </div>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-toggle" onclick="togglePrivacyOption(this)"></div>
                        <div class="privacy-option-info">
                            <h4>Analytics Cookies</h4>
                            <p>Help us understand how you use our site to improve your experience.</p>
                        </div>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-toggle" onclick="togglePrivacyOption(this)"></div>
                        <div class="privacy-option-info">
                            <h4>Marketing Cookies</h4>
                            <p>Used to show you relevant advertisements and content.</p>
                        </div>
                    </div>
                    
                    <div class="privacy-settings-actions">
                        <button class="privacy-btn secondary" onclick="closePrivacySettings()">Cancel</button>
                        <button class="privacy-btn primary" onclick="savePrivacySettings()">Save Settings</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            log('‚öôÔ∏è Privacy settings modal opened');
        }

        // API security testing functions
        function testAPIKeyRotation() {
            // Simulate API key rotation
            const oldKey = 'old-api-key-12345';
            const newKey = 'new-api-key-67890';
            
            log(`üîÑ API key rotated: ${oldKey} ‚Üí ${newKey}`);
        }

        function testSecureStorage() {
            const testData = 'sensitive-user-data';
            const encrypted = securityManager.encryptData(testData);
            const decrypted = securityManager.decryptData(encrypted);
            
            log(`üîê Secure storage test:`);
            log(`   Original: ${testData}`);
            log(`   Encrypted: ${encrypted.substring(0, 20)}...`);
            log(`   Decrypted: ${decrypted}`);
            log(`   Success: ${testData === decrypted ? '‚úÖ' : '‚ùå'}`);
        }

        function testCSRFProtection() {
            const token = securityManager.generateCSRFToken();
            securityManager.addCSRFTokenToForms();
            log(`üõ°Ô∏è CSRF protection test: Token ${token.substring(0, 8)}... added to forms`);
        }

        function simulateSecurityBreach() {
            securityManager.logSecurityEvent('security_breach_simulation', {
                type: 'unauthorized_access',
                severity: 'high',
                source: 'test-simulation'
            });
            
            securityMetrics.securityEvents++;
            updateSecurityMetrics();
            log('üö® Security breach simulation logged');
        }

        // Security monitoring functions
        function generateSecurityReport() {
            const report = securityManager.getSecurityDashboard();
            log('üìä Security Report Generated:');
            log(`   Active Sessions: ${report.sessions.active}`);
            log(`   Rate Limit Violations: ${report.rateLimits.violations}`);
            log(`   XSS Attempts Blocked: ${report.security.xssBlocked}`);
            log(`   GDPR Consent: ${report.security.gdprConsent}`);
            console.log('Full security report:', report);
        }

        function exportSecurityLogs() {
            const logs = securityManager.securityEvents;
            const blob = new Blob([JSON.stringify(logs, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `security-logs-${Date.now()}.json`;
            a.click();
            
            log('üì• Security logs exported');
        }

        function clearSecurityEvents() {
            securityManager.securityEvents = [];
            securityMetrics.securityEvents = 0;
            updateSecurityMetrics();
            log('üóëÔ∏è Security events cleared');
        }

        function showSecurityMetrics() {
            const dashboard = securityManager.getSecurityDashboard();
            log('üìà Current Security Metrics:');
            Object.entries(dashboard).forEach(([category, data]) => {
                log(`   ${category}: ${JSON.stringify(data)}`);
            });
        }

        // Dashboard functions
        function toggleSecurityDashboard() {
            // Create security dashboard if it doesn't exist
            let dashboard = document.getElementById('security-dashboard');
            
            if (!dashboard) {
                dashboard = document.createElement('div');
                dashboard.id = 'security-dashboard';
                dashboard.className = 'security-dashboard';
                dashboard.innerHTML = `
                    <div class="security-dashboard-header">
                        <h2 class="security-dashboard-title">
                            üîí Security Dashboard
                            <button class="security-dashboard-close" onclick="toggleSecurityDashboard()">√ó</button>
                        </h2>
                    </div>
                    <div class="security-dashboard-content">
                        <div class="security-section">
                            <h3>System Status</h3>
                            <div class="security-metric">
                                <span class="security-metric-label">Security Manager</span>
                                <span class="security-metric-value">Active</span>
                            </div>
                            <div class="security-metric">
                                <span class="security-metric-label">Input Validation</span>
                                <span class="security-metric-value">Enabled</span>
                            </div>
                            <div class="security-metric">
                                <span class="security-metric-label">Rate Limiting</span>
                                <span class="security-metric-value">Active</span>
                            </div>
                        </div>
                        
                        <div class="security-section">
                            <h3>Recent Events</h3>
                            <div class="security-events" id="dashboard-events">
                                <div class="security-event">
                                    <div class="security-event-type">System Initialized</div>
                                    <div class="security-event-time">Just now</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(dashboard);
            }
            
            dashboard.classList.toggle('open');
            log('üìä Security dashboard toggled');
        }

        // Utility functions
        function updateStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = status;
            }
        }

        function updateSecurityMetrics() {
            document.getElementById('events-count').textContent = securityMetrics.securityEvents;
            document.getElementById('active-sessions').textContent = securityMetrics.activeSessions;
            document.getElementById('rate-violations').textContent = securityMetrics.rateViolations;
            document.getElementById('xss-blocked').textContent = securityMetrics.xssBlocked;
            document.getElementById('validation-failures').textContent = securityMetrics.validationFailures;
        }

        function log(message) {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function startSecurityMonitoring() {
            setInterval(() => {
                // Update security metrics periodically
                if (securityManager) {
                    const dashboard = securityManager.getSecurityDashboard();
                    securityMetrics.securityEvents = securityManager.securityEvents.length;
                    updateSecurityMetrics();
                }
            }, 5000);
        }

        // Privacy settings functions
        function togglePrivacyOption(toggle) {
            if (!toggle.classList.contains('active') || toggle.parentElement.querySelector('h4').textContent !== 'Essential Cookies') {
                toggle.classList.toggle('active');
            }
        }

        function closePrivacySettings() {
            const modal = document.querySelector('.privacy-settings-modal');
            if (modal) {
                modal.remove();
            }
        }

        function savePrivacySettings() {
            const toggles = document.querySelectorAll('.privacy-toggle');
            const settings = {
                essential: true, // Always true
                analytics: toggles[1].classList.contains('active'),
                marketing: toggles[2].classList.contains('active'),
                timestamp: Date.now()
            };
            
            localStorage.setItem('explorex-privacy-settings', JSON.stringify(settings));
            log('‚öôÔ∏è Privacy settings saved');
            closePrivacySettings();
        }

        // Global functions for GDPR banner
        window.ExploreXSecurity = {
            acceptGDPRConsent: () => {
                securityManager.acceptGDPRConsent();
                log('‚úÖ GDPR consent accepted');
            },
            declineGDPRConsent: () => {
                securityManager.declineGDPRConsent();
                log('‚ùå GDPR consent declined');
            },
            showPrivacySettings: showPrivacySettings
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeSecuritySystem);

        // Add some automatic security events for demo
        setInterval(() => {
            if (Math.random() < 0.2) { // 20% chance every 15 seconds
                const events = [
                    () => testXSSPrevention(),
                    () => testFormValidation(),
                    () => createSecureSession()
                ];
                const randomEvent = events[Math.floor(Math.random() * events.length)];
                randomEvent();
            }
        }, 15000);
    </script>
</body>
</html>